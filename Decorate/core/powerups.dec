// Powerup Pickup Base
actor SamsaraPowerupPickup : CustomInventory
{
    RenderStyle "Add"
    +FLOATBOB
    +NOTIMEFREEZE // allow the checks and sprite to process during time freeze
    +QUIET
    +THRUACTORS // don't allow picking up until the checks are done
    States
    {
      // Spawn code
      Spawn:
        TNT1 A 0
      SpawnGameModeCheck:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 19), "SpawnNothing") // Prevent spawning in LMS
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 29), "SpawnNothing") // Prevent spawning in instagib
      SpawnActualInit:
        TNT1 A 1 A_Jump(256,"SpawnActual")
        loop

      SpawnActual:
        TNT1 A 0
        stop

      SpawnNothing:
        TNT1 A 0 A_ChangeFlag("COUNTITEM",false)
        stop

      // Pickup code
      Pickup:
        TNT1 A 0
        fail

      PickupFail:
        TNT1 A 0
        fail

      PickupStop:
        TNT1 A 0
        stop
    }
}

actor SamsaraPowerupPickupBlend : Trigger
{
    States
    {
      Pickup:
        TNT1 A 0 A_JumpIfInventory("PickupFlashesAreDisabled",1,"PickupStop")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupMarathon")
        TNT1 A 0 A_SetBlend("D7BA45",0.3,4)
        stop

      PickupMarathon:
        TNT1 A 0 A_SetBlend("Green",0.5,6)
        stop
    }
}

// Partial Invisibility
actor PartialInvisibility : SamsaraPowerupPickup
{
    Inventory.PickupFlash "PickupFlash"
    Alpha 0.75
    +BIGPOWERUP
    +VISIBILITYPULSE
    States
    {
      Spawn:
        NVSI A 0 Bright Light("SAMSARA_INVISIBILITY") NoDelay ACS_NamedExecuteWithResult("Samsara_SwitchableObject", 19)
      SpawnDropCheck:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 1, 1), 1)
        goto SpawnGameModeCheck
        TNT1 A 0 A_ChangeFlag("COUNTITEM",false)
        goto SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        TNT1 A 0 A_ChangeFlag("NOTIMEFREEZE",false)
      SpawnActualAnim:
        NVSI A 35 Bright Light("SAMSARA_INVISIBILITY") ACS_NamedExecuteAlways("SamsaraClientDecorate", 0, 4, 100, 75)
        loop

      Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupHeretic")
        TNT1 A 0 A_JumpIfInventory("DukeClass",1,"PickupDuke")
        TNT1 A 0 A_JumpIfInventory("StrifeClass",1,"PickupStrife")
        TNT1 A 0 A_JumpIfInventory("WitchavenClass",1,"PickupWitchaven")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"PickupPowerSlave")
        TNT1 A 0 A_JumpIfInventory("BittermanClass",1,"PickupQuake2")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"PickupHexen2")
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        goto PickupDisplay

      PickupHeretic:
        TNT1 A 0 A_JumpIfInventory("PortGhostly",0,"PickupFail")
        goto PickupDisplay

      PickupDuke:
        TNT1 A 0 A_JumpIfInventory("ItemHoloduke",0,"PickupFail")
        TNT1 A 0 A_JumpIfInventory("ItemHolodukeLAB",0,"PickupFail")
        TNT1 A 0 A_JumpIfInventory("ItemHoloduke64",0,"PickupFail")
        goto PickupDisplay

      PickupStrife:
        TNT1 A 0 A_JumpIfInventory("PortShadowArmor",0,"PickupFail")
        goto PickupDisplay

      PickupWitchaven:
        TNT1 A 0 A_JumpIfInventory("WTInvisibilityPhial",0,"PickupFail")
        goto PickupDisplay

      PickupPowerSlave:
        TNT1 A 0 A_JumpIfInventory("EyeOfSiaItem_EX",0,"PickupFail")
        goto PickupDisplay

      PickupQuake2:
        TNT1 A 0 A_JumpIfInventory("Q2Silencer",0,1)
        goto PickupDisplay
        TNT1 A 0 A_JumpIfInventory("Q2DualFireDamage",0,"PickupFail")
        goto PickupDisplay

      PickupHexen2:
        TNT1 A 0 A_JumpIfInventory("PortGhostly2",0,"PickupFail")
        goto PickupDisplay

      PickupDisplay:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupDisplayHeretic")
        TNT1 A 0 A_JumpIfInventory("DukeClass",1,"PickupDisplayDuke")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupDisplayMarathon")
        TNT1 A 0 A_JumpIfInventory("QuakeClass",1,"PickupDisplayQuake1")
        TNT1 A 0 A_JumpIfInventory("StrifeClass",1,"PickupDisplayStrife")
        TNT1 A 0 A_JumpIfInventory("WitchavenClass",1,"PickupDisplayWitchaven")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"PickupDisplayPowerSlave")
        TNT1 A 0 A_JumpIfInventory("BittermanClass",1,"PickupDisplayQuake2")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"PickupDisplayHexen2")
        TNT1 A 0 A_JumpIfInventory("Q3Class",1,"PickupDisplayQuake3")
        TNT1 A 0 A_Jump(256,"PickupDisplayDefault") // for inheriting actors
        goto PickupDisplayDefault

      PickupDisplayDefault:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("invisibilityget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 2)
        goto PickupSuccess

      PickupDisplayHeretic:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 2)
        goto PickupSuccess

      PickupDisplayDuke:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 2)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("duke/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 2)
        goto PickupSuccess

      PickupDisplayMarathon:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("marathon/bigitemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 2)
        goto PickupSuccess

      PickupDisplayQuake1:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 3)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraDecorate", 0, 25) //A_PlaySound("quake/invisannouncer",CHAN_7,1.0,false,ATTN_NONE)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 2)
        goto PickupSuccess

      PickupDisplayStrife:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 4)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("strife/itempickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 2)
        goto PickupSuccess

      PickupDisplayWitchaven:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 5)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("gpickup/phial",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 2)
        goto PickupSuccess

      PickupDisplayPowerSlave:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 6)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("Jon/FancyItemPick",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 2)
        goto PickupSuccess

      // Bitterman's pickup messages need special treatment due to being given a random item.
      // This determines which item to jump to.
      PickupDisplayQuake2:
        TNT1 A 0 A_Jump(256,"PickupDisplayQuake2Silencer","PickupDisplayQuake2DualFireDamage")
      PickupDisplayQuake2Silencer:
        TNT1 A 0 A_JumpIfInventory("Q2Silencer",0,"PickupDisplayQuake2")
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 7)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("Q2Misc/Pickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 2)
        goto PickupSuccessQuake2Silencer

      PickupDisplayQuake2DualFireDamage:
        TNT1 A 0 A_JumpIfInventory("Q2DualFireDamage",0,"PickupDisplayQuake2")
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 8)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("Q2Misc/Pickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 2)
        goto PickupSuccessQuake2DualFireDamage

      PickupDisplayHexen2:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, random(9,10))
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("Hexen2/ArtifactPickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 2)
        goto PickupSuccess

      PickupDisplayQuake3:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 11)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 ACS_NamedExecuteAlways("Q3_Announcer", 0, 0) //A_PlaySound("Quake3/Items/Invisibility",CHAN_6)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 2)
        goto PickupSuccess

      PickupSuccess:
        TNT1 A 0 A_JumpIfInventory("DoomguyClass",1,"PickupSuccessDoom")
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupSuccessHexen1")
        TNT1 A 0 A_JumpIfInventory("DukeClass",1,"PickupSuccessDuke")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupSuccessMarathon")
        TNT1 A 0 A_JumpIfInventory("QuakeClass",1,"PickupSuccessQuake1")
        TNT1 A 0 A_JumpIfInventory("CalebClass",1,"PickupSuccessBlood")
        TNT1 A 0 A_JumpIfInventory("StrifeClass",1,"PickupSuccessStrife")
        TNT1 A 0 A_JumpIfInventory("RMRClass",1,"PickupSuccessRMR")
        TNT1 A 0 A_JumpIfInventory("WitchavenClass",1,"PickupSuccessWitchaven")
        TNT1 A 0 A_JumpIfInventory("HalfLifeClass",1,"PickupSuccessHalfLife")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"PickupSuccessPowerSlave")
        TNT1 A 0 A_JumpIfInventory("BittermanClass",1,"PickupSuccessQuake2")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"PickupSuccessHexen2")
        TNT1 A 0 A_JumpIfInventory("BondClass",1,"PickupSuccessGoldenEye")
        TNT1 A 0 A_JumpIfInventory("PainkillerClass",1,"PickupSuccessPainkiller")
        TNT1 A 0 A_JumpIfInventory("UnrealClass",1,"PickupSuccessUnreal")
        TNT1 A 0 A_JumpIfInventory("RTCWClass",1,"PickupSuccessRTCW")
        TNT1 A 0 A_JumpIfInventory("Q3Class",1,"PickupSuccessQuake3")
        TNT1 A 0 A_JumpIfInventory("DescentClass",1,"PickupSuccessDescent")
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"PickupSuccessDeusEx")
        TNT1 A 0 A_Jump(256,"PickupSuccessDefault") // for inheriting actors
        goto PickupSuccessDefault

      PickupSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerInvisibilityGiver")
        stop

      PickupSuccessDoom:
        TNT1 A 0 A_JumpIfInventory("DoomClassMode",2,"PickupSuccessStronghold")
        TNT1 A 0 A_JumpIfInventory("DoomClassMode",1,"PickupSuccessDoom64")
        goto PickupSuccessDefault

      PickupSuccessDoom64:
        TNT1 A 0 A_GiveInventory("SamsaraPowerInvisibilityGiverTranslucent")
        stop

      PickupSuccessStronghold:
        goto PickupSuccessDefault

      PickupSuccessHeretic:
        TNT1 A 0 A_GiveInventory("PortGhostly")
        stop

      PickupSuccessHexen1:
        TNT1 A 0 A_GiveInventory("SamsaraPowerGhostGiver")
        stop

      PickupSuccessDuke:
        TNT1 A 0 A_JumpIfInventory("DukeClassMode",2,"PickupSuccessDuke64")
        TNT1 A 0 A_JumpIfInventory("DukeClassMode",1,"PickupSuccessDukeLAB")
        TNT1 A 0 A_GiveInventory("ItemHoloduke",3)
        stop

      PickupSuccessDukeLAB:
        TNT1 A 0 A_GiveInventory("ItemHolodukeLAB",3)
        stop

      PickupSuccessDuke64:
        TNT1 A 0 A_GiveInventory("ItemHoloduke64",3)
        stop

      PickupSuccessMarathon:
        TNT1 AA 0 A_GiveInventory("SamsaraPowerShadowGiver")
        TNT1 A 0 A_GiveInventory("SamsaraPowerShadowCumulativeLockGiver")
        stop

      PickupSuccessQuake1:
        TNT1 A 0 A_GiveInventory("QuakeInvisTimer",1050)
        stop

      PickupSuccessBlood:
        goto PickupSuccessDoom64

      PickupSuccessStrife:
        TNT1 A 0 A_GiveInventory("PortShadowArmor")
        stop

      PickupSuccessRMR:
        goto PickupSuccessDoom64

      PickupSuccessWitchaven:
        TNT1 A 0 A_GiveInventory("WTInvisibilityPhial")
        stop

      PickupSuccessHalfLife:
        goto PickupSuccessDoom64

      PickupSuccessPowerSlave:
        TNT1 A 0 A_GiveInventory("EyeOfSiaItem_EX")
        stop

      PickupSuccessQuake2:
        TNT1 A 0 A_Jump(256,"PickupSuccessQuake2Silencer","PickupSuccessQuake2DualFireDamage")
      PickupSuccessQuake2Silencer:
        TNT1 A 0 A_JumpIfInventory("Q2Silencer",0,"PickupSuccessQuake2")
        TNT1 A 0 A_GiveInventory("Q2Silencer")
        stop

      PickupSuccessQuake2DualFireDamage:
        TNT1 A 0 A_JumpIfInventory("Q2DualFireDamage",0,"PickupSuccessQuake2")
        TNT1 A 0 A_GiveInventory("Q2DualFireDamage")
        stop

      PickupSuccessHexen2:
        TNT1 A 0 A_GiveInventory("PortGhostly2")
        stop

      PickupSuccessGoldenEye:
        goto PickupSuccessDoom64

      PickupSuccessPainkiller:
        goto PickupSuccessDoom64

      PickupSuccessUnreal:
        goto PickupSuccessDoom64

      PickupSuccessRTCW:
        TNT1 A 0 A_TakeInventory("RTCW_Detection")
        goto PickupSuccessDoom64

      PickupSuccessQuake3:
        TNT1 A 0 A_GiveInventory("Q3InvisibilityCloak")
        stop

      PickupSuccessDescent:
        goto PickupSuccessDoom64

      PickupSuccessDeusEx:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 23)
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",0,"PickupSuccessDeusExMaster")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",3,"PickupSuccessDeusExAdvanced")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",2,"PickupSuccessDeusExProficient")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",1,"PickupSuccessDeusExTrained")
      PickupSuccessDeusExUntrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerInvisibilityGiverTranslucentDeusEx1")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExTrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerInvisibilityGiverTranslucentDeusEx2")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExProficient:
        TNT1 A 0 A_GiveInventory("SamsaraPowerInvisibilityGiverTranslucentDeusEx3")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExAdvanced:
        TNT1 A 0 A_GiveInventory("SamsaraPowerInvisibilityGiverTranslucentDeusEx4")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExMaster:
        TNT1 A 0 A_GiveInventory("SamsaraPowerInvisibilityGiverTranslucentDeusEx5")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExFinish:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 100)
        stop
    }
}

actor DoomPartialInvisibility : PartialInvisibility replaces BlurSphere { +COUNTITEM }
actor HereticPartialInvisibility : PartialInvisibility replaces ArtiInvisibility { +COUNTITEM }

actor SamsaraPowerInvisibilityGiver : SamsaraPowerupGiver { Powerup.Type "Invisibility" }
actor SamsaraPowerInvisibilityGiverTranslucent : SamsaraPowerInvisibilityGiver { Powerup.Mode "Translucent" } // Use this for 3D models
actor SamsaraPowerGhostGiver : SamsaraPowerupGiver { Powerup.Type "Ghost" }
actor SamsaraPowerShadowGiver : SamsaraPowerupGiver { Powerup.Type "Shadow" }

actor SamsaraPowerShadowCumulativeLockGiver : SamsaraPowerupGiver { Powerup.Type "ShadowCumulativeLock" }

actor PowerShadowCumulativeLock : Powerup
{
    Powerup.Duration -55
    +HUBPOWER
}

actor SamsaraPartialInvisibilityInventory : CustomInventory
{
    Inventory.UseSound ""
    +INVBAR
    +UNDROPPABLE
    States
    {
      Use:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UseHeretic")
        TNT1 A 0 A_JumpIfInventory("StrifeClass",1,"UseStrife")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"UsePowerSlave")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"UseHexen2")
        TNT1 A 0 A_Jump(256,"UseDefault") // for inheriting actors
        goto UseDefault

      UseDefault:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 0, 0), "UseFail")
        goto UsePlaySound

      UseHeretic:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 0, 1), "UseFail")
        goto UsePlaySound

      UseStrife:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 0, 2), 1)
        goto UsePlaySound
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 0, 3), "UseFail") // not the best method, but it works
        goto UsePlaySound

      UsePowerSlave:
        goto UseHeretic

      UseHexen2:
        goto UseHeretic

      UsePlaySound:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UsePlaySoundHeretic")
        TNT1 A 0 A_JumpIfInventory("StrifeClass",1,"UsePlaySoundStrife")
        TNT1 A 0 A_JumpIfInventory("WitchavenClass",1,"UsePlaySoundWitchaven")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"UsePlaySoundPowerSlave")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"UsePlaySoundHexen2")
        TNT1 A 0 A_Jump(256,"UsePlaySoundDefault") // for inheriting actors
        goto UsePlaySoundDefault

      UsePlaySoundDefault:
        goto UseSuccess

      UsePlaySoundHeretic:
        TNT1 A 0 A_PlaySound("heretic/itemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundStrife:
        TNT1 A 0 A_PlaySound("strife/itempickup",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundWitchaven:
        TNT1 A 0 A_PlaySound("gplayer/drink",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundPowerSlave:
        TNT1 A 0 A_PlaySound("Jon/itemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHexen2:
        TNT1 A 0 A_PlaySound("Hexen2/ArtiUse",CHAN_ITEM)
        goto UseSuccess

      UseSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UseSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("StrifeClass",1,"UseSuccessStrife")
        TNT1 A 0 A_JumpIfInventory("WitchavenClass",1,"UseSuccessWitchaven")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"UseSuccessPowerSlave")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"UseSuccessHexen2")
        TNT1 A 0 A_Jump(256,"UseSuccessDefault") // for inheriting actors
        goto UseSuccessDefault

      UseSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerInvisibilityGiver")
        goto UseFinish

      UseSuccessHeretic:
        TNT1 A 0 A_GiveInventory("SamsaraPowerGhostGiver")
        goto UseFinish

      UseSuccessStrife:
        TNT1 A 0 A_JumpIfInventory("PowerShadow",1,"UseSuccessStrifeSubsequent")
        TNT1 A 0 A_GiveInventory("SamsaraPowerShadowGiver")
        goto UseFinish

      UseSuccessStrifeSubsequent:
        TNT1 A 0 A_GiveInventory("SamsaraPowerShadowGiver")
        TNT1 A 0 A_GiveInventory("SamsaraPowerShadowCumulativeLockGiver")
        goto UseFinish

      UseSuccessWitchaven:
        TNT1 A 0 A_GiveInventory("SamsaraPowerInvisibilityGiverWitchaven")
        goto UseFinish

      UseSuccessPowerSlave:
        goto UseSuccessHeretic

      UseSuccessHexen2:
        goto UseSuccessHeretic

      UseFinish:
        TNT1 A 0 A_RailWait
        stop

      UseFail:
        TNT1 A 0
        fail
    }
}

actor PortGhostly : SamsaraPartialInvisibilityInventory
{
    Inventory.Icon "ARTINVSI"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.RestrictedTo "CorvusPlayer"
    Tag "Shadowsphere"
}

actor QuakeInvisTimer: Counter {}

actor PortShadowArmor : SamsaraPartialInvisibilityInventory
{
    Inventory.Icon "I_SHDO"
    Inventory.MaxAmount 2
    Inventory.InterHubAmount 2
    Inventory.RestrictedTo "StrifeguyPlayer"
    Tag "Shadow Armor"
}

actor WTInvisibilityPhial : SamsaraPartialInvisibilityInventory
{
    Inventory.Icon "WIN0F0"
    Inventory.MaxAmount 10
    Inventory.InterHubAmount 10
    Inventory.RestrictedTo "GrondovalPlayer"
    Tag "Invisibility Potion"
}

actor SamsaraPowerInvisibilityGiverWitchaven : SamsaraPowerInvisibilityGiver { Powerup.Duration -30 }

actor EyeOfSiaItem_EX : SamsaraPartialInvisibilityInventory
{
    Inventory.Icon "_EX3E0"
    Inventory.MaxAmount 3
    Inventory.InterHubAmount 3
    Inventory.RestrictedTo "PSPlayer"
    Tag "Eye of Sia"
}

actor PortGhostly2 : SamsaraPartialInvisibilityInventory
{
    Inventory.Icon "H2INVT08"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.RestrictedTo "Demoness"
    Tag "Shadowsphere"
}

actor SamsaraPowerInvisibilityGiverTranslucentDeusEx1 : SamsaraPowerInvisibilityGiverTranslucent {}
actor SamsaraPowerInvisibilityGiverTranslucentDeusEx2 : SamsaraPowerInvisibilityGiverTranslucent { Powerup.Duration -75 }
actor SamsaraPowerInvisibilityGiverTranslucentDeusEx3 : SamsaraPowerInvisibilityGiverTranslucent { Powerup.Duration -90 }
actor SamsaraPowerInvisibilityGiverTranslucentDeusEx4 : SamsaraPowerInvisibilityGiverTranslucent { Powerup.Duration -105 }
actor SamsaraPowerInvisibilityGiverTranslucentDeusEx5 : SamsaraPowerInvisibilityGiverTranslucent { Powerup.Duration -120 }

/*
actor InvisTrail
{
    RenderStyle "Add"
    Alpha 0.35
    Scale 0.95
    +CLIENTSIDEONLY
    +NOINTERACTION
    States
    {
      Spawn:
        NVSI A 2 A_FadeOut(0.125)
        loop
    }
}
*/

// Invulnerability
actor InvulnPowerup : SamsaraPowerupPickup
{
    Inventory.PickupFlash "PickupFlash"
    Alpha 0.95
    +BIGPOWERUP
    States
    {
      Spawn:
        NVLN A 0 Bright Light("SAMSARA_INVULNERABILITY") NoDelay ACS_NamedExecuteWithResult("Samsara_SwitchableObject", 20)
      SpawnDropCheck:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 1, 1), 1)
        goto SpawnGameModeCheck
        TNT1 A 0 A_ChangeFlag("COUNTITEM",false)
        goto SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        TNT1 A 0 A_ChangeFlag("NOTIMEFREEZE",false)
      SpawnActualAnim:
        NVLN A 35 Bright Light("SAMSARA_INVULNERABILITY") ACS_NamedExecuteAlways("SamsaraClientDecorate", 0, 4, 100, 95)
        loop

      Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupHexen1")
        TNT1 A 0 A_JumpIfInventory("RottClass",1,"PickupROTT")
        TNT1 A 0 A_JumpIfInventory("POGreedClass",1,"PickupIPOG")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"PickupPowerSlave")
        TNT1 A 0 A_JumpIfInventory("BittermanClass",1,"PickupQuake2")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"PickupHexen2")
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        goto PickupDisplay

      PickupHeretic:
        TNT1 A 0 A_JumpIfInventory("PortRingInvuln",0,"PickupFail")
        goto PickupDisplay

      PickupHexen1:
        TNT1 A 0 A_JumpIfInventory("PortIconDefender",0,"PickupFail")
        goto PickupDisplay

      PickupROTT:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 56), "PickupDefault")
        TNT1 A 0 A_JumpIfInventory("PowerGodProtection",1,"PickupFail")
        TNT1 A 0 A_JumpIfInventory("PowerDoggyMorph",1,"PickupFail")
        goto PickupDisplay

      PickupIPOG:
        TNT1 A 0 A_JumpIfInventory("IPOGReversoPill",0,"PickupFail")
        goto PickupDisplay

      PickupPowerSlave:
        TNT1 A 0 A_JumpIfInventory("DivineScarab_Ex",0,"PickupFail")
        goto PickupDisplay

      PickupQuake2:
        TNT1 A 0 A_JumpIfInventory("Q2Invulnerability",0,"PickupFail")
        goto PickupDisplay

      PickupHexen2:
        TNT1 A 0 A_JumpIfInventory("PortIconDefender2",0,"PickupFail")
        goto PickupDisplay

      PickupDisplay:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupDisplayHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupDisplayHexen1")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupDisplayMarathon")
        TNT1 A 0 A_JumpIfInventory("QuakeClass",1,"PickupDisplayQuake1")
        TNT1 A 0 A_JumpIfInventory("RottClass",1,"PickupDisplayROTT")
        TNT1 A 0 A_JumpIfInventory("POGreedClass",1,"PickupDisplayIPOG")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"PickupDisplayPowerSlave")
        TNT1 A 0 A_JumpIfInventory("BittermanClass",1,"PickupDisplayQuake2")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"PickupDisplayHexen2")
        TNT1 A 0 A_Jump(256,"PickupDisplayDefault") // for inheriting actors
        goto PickupDisplayDefault

      PickupDisplayDefault:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 2, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("invulnget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 3)
        goto PickupSuccess

      PickupDisplayHeretic:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 2, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 3)
        goto PickupSuccess

      PickupDisplayHexen1:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 2, 2)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("hexen/artiget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 3)
        goto PickupSuccess

      PickupDisplayMarathon:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 2, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("marathon/bigitemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 3)
        goto PickupSuccess

      PickupDisplayQuake1:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 2, 3)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        // pickup sound handled through ACS
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 3)
        goto PickupSuccess

      // ROTT's pickup messages need special treatment due to being given a random item.
      // This determines which item to jump to.
      PickupDisplayROTT:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 56), "PickupDisplayDefault")
        TNT1 A 0 A_Jump(256,"PickupDisplayROTTGodMode","PickupDisplayROTTDogMode")
      PickupDisplayROTTGodMode:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 2, 4)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("gen/godmode",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 3)
        goto PickupSuccessROTTGodMode

      PickupDisplayROTTDogMode:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 2, 5)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("gen/dogmode",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 3)
        goto PickupSuccessROTTDogMode

      PickupDisplayIPOG:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 2, 6)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("greed/pickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 3)
        goto PickupSuccess

      PickupDisplayPowerSlave:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 2, 7)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("Jon/SpecialItemPick",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 3)
        goto PickupSuccess

      PickupDisplayQuake2:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 2, 8)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("Q2Misc/Pickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 3)
        goto PickupSuccess

      PickupDisplayHexen2:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 2, random(9,10))
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("Hexen2/ArtifactPickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 3)
        goto PickupSuccess

      PickupSuccess:
        TNT1 A 0 A_JumpIfInventory("DoomguyClass",1,"PickupSuccessDoom")
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupSuccessHexen1")
        TNT1 A 0 A_JumpIfInventory("DukeClass",1,"PickupSuccessDuke")
        TNT1 A 0 A_JumpIfInventory("QuakeClass",1,"PickupSuccessQuake1")
        TNT1 A 0 A_JumpIfInventory("RottClass",1,"PickupSuccessROTT")
        TNT1 A 0 A_JumpIfInventory("C7Class",1,"PickupSuccessCorridor7")
        TNT1 A 0 A_JumpIfInventory("RMRClass",1,"PickupSuccessRMR")
        TNT1 A 0 A_JumpIfInventory("POGreedClass",1,"PickupSuccessIPOG")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"PickupSuccessPowerSlave")
        TNT1 A 0 A_JumpIfInventory("BittermanClass",1,"PickupSuccessQuake2")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"PickupSuccessHexen2")
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"PickupSuccessDeusEx")
        TNT1 A 0 A_Jump(256,"PickupSuccessDefault") // for inheriting actors
        goto PickupSuccessDefault

      PickupSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiver")
        stop

      PickupSuccessDoom:
        TNT1 A 0 A_JumpIfInventory("DoomClassMode",2,"PickupSuccessStronghold")
        TNT1 A 0 A_JumpIfInventory("DoomClassMode",1,"PickupSuccessDoom64")
        goto PickupSuccessDefault

      PickupSuccessDoom64:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverDoom64")
        stop

      PickupSuccessStronghold:
        goto PickupSuccessDefault

      PickupSuccessHeretic:
        TNT1 A 0 A_GiveInventory("PortRingInvuln")
        stop

      PickupSuccessHexen1:
        TNT1 A 0 A_GiveInventory("PortIconDefender")
        stop

      PickupSuccessDuke:
        TNT1 A 0 A_GiveInventory("DukeInvulnTaunt")
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverDuke")
        stop

      PickupSuccessQuake1:
        TNT1 A 0 A_GiveInventory("QuakePentTimer",1050)
        stop

      PickupSuccessROTT:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 56), "PickupSuccessDefault")
        TNT1 A 0 A_Jump(256,"PickupSuccessROTTGodMode","PickupSuccessROTTDogMode")
      PickupSuccessROTTGodMode:
        TNT1 A 0 A_JumpIfInventory("PowerGodProtection",1,"PickupSuccessROTTGodModeSubsequent") // just in case
        TNT1 A 0 A_GiveInventory("God Hand")
        TNT1 A 0 A_GiveInventory("GodProtection")
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraROTTGodMode")
        stop

      PickupSuccessROTTGodModeSubsequent:
        TNT1 A 0 A_GiveInventory("God Hand")
        TNT1 A 0 A_GiveInventory("GodProtection")
        stop

      PickupSuccessROTTDogMode:
        TNT1 A 0 A_JumpIfInventory("PowerDoggyMorph",1,"PickupSuccessROTTDogModeSubsequent") // just in case
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraROTTDogModeInit")
        TNT1 A 0 A_GiveInventory("DoggyMorph")
        TNT1 A 0 A_GiveInventory("DogProtection")
        stop

      PickupSuccessROTTDogModeSubsequent:
        TNT1 A 0 A_GiveInventory("DoggyMorph")
        TNT1 A 0 A_GiveInventory("DogProtection")
        stop

      PickupSuccessCorridor7:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverCorridor7")
        stop

      PickupSuccessRMR:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverRMR")
        stop

      PickupSuccessIPOG:
        TNT1 A 0 A_GiveInventory("IPOGReversoPill")
        stop

      PickupSuccessPowerSlave:
        TNT1 A 0 A_GiveInventory("DivineScarab_Ex")
        stop

      PickupSuccessQuake2:
        TNT1 A 0 A_GiveInventory("Q2Invulnerability")
        stop

      PickupSuccessHexen2:
        TNT1 A 0 A_GiveInventory("PortIconDefender2")
        stop

      PickupSuccessDeusEx:
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",0,"PickupSuccessDeusExMaster")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",3,"PickupSuccessDeusExAdvanced")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",2,"PickupSuccessDeusExProficient")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",1,"PickupSuccessDeusExTrained")
      PickupSuccessDeusExUntrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverDeusEx1")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExTrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverDeusEx2")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExProficient:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverDeusEx3")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExAdvanced:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverDeusEx4")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExMaster:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverDeusEx5")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExFinish:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 250)
        stop
    }
}

actor DoomInvulnPowerup : InvulnPowerup replaces InvulnerabilitySphere { +COUNTITEM }
actor HereticInvulnPowerup : InvulnPowerup replaces ArtiInvulnerability { +COUNTITEM }
actor HexenInvulnPowerup : InvulnPowerup replaces ArtiInvulnerability2 { +COUNTITEM }

actor SamsaraPowerFakeInvulnerableGiver : SamsaraPowerupGiver
{
    Powerup.Type "FakeInvulnerable"
    Powerup.Color "InverseMap"
}

actor PowerFakeInvulnerable : PowerProtection
{
    Powerup.Duration -30
    DamageFactor "Suicide", 1
    DamageFactor "Telefrag", 1
    DamageFactor "MarathonFusion", 1
    DamageFactor "Kamikaze", 1
    DamageFactor "ZorchKamikaze", 1
    DamageFactor "Normal", 0
}

actor SamsaraInvulnPowerupInventory : CustomInventory
{
    Inventory.UseSound ""
    +INVBAR
    +UNDROPPABLE
    States
    {
      Use:
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UseHexen1")
        TNT1 A 0 A_Jump(256,"UseDefault") // for inheriting actors
        goto UseDefault

      UseDefault:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 1, 0), "UseFail")
        goto UsePlaySound

      UseHexen1:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 1, 1), "UseFail")
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 1, 2), "UseFail")
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 1, 3), "UseFail")
        goto UsePlaySound

      UsePlaySound:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UsePlaySoundHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UsePlaySoundHexen1")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"UsePlaySoundPowerSlave")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"UsePlaySoundHexen2")
        TNT1 A 0 A_Jump(256,"UsePlaySoundDefault") // for inheriting actors
        goto UsePlaySoundDefault

      UsePlaySoundDefault:
        goto UseSuccess

      UsePlaySoundHeretic:
        TNT1 A 0 A_PlaySound("heretic/itemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHexen1:
        TNT1 A 0 A_PlaySound("hexen/artiuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundPowerSlave:
        TNT1 A 0 A_PlaySound("Jon/itemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHexen2:
        TNT1 A 0 A_PlaySound("Hexen2/ArtiUse",CHAN_ITEM)
        goto UseSuccess

      UseSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UseSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UseSuccessHexen1")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"UseSuccessHexen2")
        TNT1 A 0 A_Jump(256,"UseSuccessDefault") // for inheriting actors
        goto UseSuccessDefault

      UseSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiver")
        goto UseFinish

      UseSuccessHeretic:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverHeretic")
        goto UseFinish

      // Parias (Reincarnation/Classic) (Ghost Invulnerability)
      UseSuccessHexen1:
        TNT1 A 0 A_JumpIfInventory("HexenClassMode",3,"UseSuccessHexen1Fighter")
        TNT1 A 0 A_JumpIfInventory("HexenClassMode",2,"UseSuccessHexen1Mage")
      UseSuccessHexen1Cleric:
        TNT1 A 0 A_JumpIfInventory("PowerFakeInvulnerableCleric",1,"UseSuccessHexen1ClericSubsequent")
        TNT1 A 0 A_TakeInventory("PowerFakeInvulnerableMage")
        TNT1 A 0 A_TakeInventory("PowerFakeInvulnerableFighter")
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverCleric")
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraHexenInvulnerabilityEffect", 0)
        goto UseFinish

      UseSuccessHexen1ClericSubsequent:
        TNT1 A 0 A_TakeInventory("PowerFakeInvulnerableMage")
        TNT1 A 0 A_TakeInventory("PowerFakeInvulnerableFighter")
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverCleric")
        goto UseFinish

      // Daedolon (Reflective Invulnerability)
      UseSuccessHexen1Mage:
        TNT1 A 0 A_JumpIfInventory("PowerFakeInvulnerableMage",1,"UseSuccessHexen1MageSubsequent")
        TNT1 A 0 A_TakeInventory("PowerFakeInvulnerableCleric")
        TNT1 A 0 A_TakeInventory("PowerFakeInvulnerableFighter")
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverMage")
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraHexenInvulnerabilityEffect", 1)
        goto UseFinish

      UseSuccessHexen1MageSubsequent:
        TNT1 A 0 A_TakeInventory("PowerFakeInvulnerableCleric")
        TNT1 A 0 A_TakeInventory("PowerFakeInvulnerableFighter")
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverMage")
        goto UseFinish

      // Baratus (Normal Invulnerability)
      UseSuccessHexen1Fighter:
        TNT1 A 0 A_TakeInventory("PowerFakeInvulnerableCleric")
        TNT1 A 0 A_TakeInventory("PowerFakeInvulnerableMage")
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverFighter")
        goto UseFinish

      UseSuccessHexen2:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverHexen2")
        goto UseFinish

      UseFinish:
        TNT1 A 0 A_RailWait
        stop

      UseFail:
        TNT1 A 0
        fail
    }
}

actor SamsaraPowerFakeInvulnerableGiverDoom64 : SamsaraPowerFakeInvulnerableGiver { Powerup.Color "White", 0.35 }

actor PortRingInvuln : SamsaraInvulnPowerupInventory
{
    Inventory.Icon "ARTIINVU"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.RestrictedTo "CorvusPlayer"
    Tag "Ring of Invincibility"
}

actor SamsaraPowerFakeInvulnerableGiverHeretic : SamsaraPowerFakeInvulnerableGiver { Powerup.Color "GoldMap" }

actor PortIconDefender : SamsaraInvulnPowerupInventory
{
    Inventory.Icon "ARTIDFND"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.RestrictedTo "HexenPlayer"
    Tag "Icon of the Defender"
}

actor SamsaraPowerFakeInvulnerableGiverCleric : SamsaraPowerupGiver
{
    Powerup.Type "FakeInvulnerableCleric"
    Powerup.Color "Gray", 0.1
}

actor PowerFakeInvulnerableCleric : PowerFakeInvulnerable {}

actor SamsaraPowerFakeInvulnerableGiverMage : SamsaraPowerupGiver
{
    Powerup.Type "FakeInvulnerableMage"
    Powerup.Color "Gray", 0.1
}

actor PowerFakeInvulnerableMage : PowerFakeInvulnerable {}

actor SamsaraPowerFakeInvulnerableGiverFighter : SamsaraPowerupGiver
{
    Powerup.Type "FakeInvulnerableFighter"
    Powerup.Color "Gray", 0.1
}

actor PowerFakeInvulnerableFighter : PowerFakeInvulnerable {}

actor SamsaraPowerFakeInvulnerableGiverDuke : SamsaraPowerFakeInvulnerableGiver { Powerup.Color "GoldMap" }

actor QuakePentTimer: Counter { Inventory.InterHubAmount 0 }

actor QuakePentagram : PowerFakeInvulnerable
{
    Powerup.Duration 0x7FFFFFFF
    Powerup.Color "FF 20 00", 0.15
}

actor SamsaraPowerFakeInvulnerableGiverCorridor7 : SamsaraPowerFakeInvulnerableGiver { Powerup.Color "Yellow", 0.15 }

actor SamsaraPowerFakeInvulnerableGiverRMR : SamsaraPowerFakeInvulnerableGiver { Powerup.Colormap 0.0, 0.0, 0.0, 1.0, 0.0, 0.05 }

actor DivineScarab_Ex : SamsaraInvulnPowerupInventory
{
    Inventory.Icon "_EX3F0"
    Inventory.MaxAmount 2
    Inventory.InterHubAmount 2
    Inventory.RestrictedTo "PSPlayer"
    Tag "Divine Scarab"
}

actor PortIconDefender2 : SamsaraInvulnPowerupInventory
{
    Inventory.Icon "H2INVT07"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.RestrictedTo "Demoness"
    Tag "Icon of the Defender"
}

actor SamsaraPowerFakeInvulnerableGiverHexen2 : SamsaraPowerFakeInvulnerableGiver { Powerup.Color "Gray", 0.1 }

actor SamsaraPowerFakeInvulnerableGiverDeusEx1 : SamsaraPowerFakeInvulnerableGiver {}
actor SamsaraPowerFakeInvulnerableGiverDeusEx2 : SamsaraPowerFakeInvulnerableGiver { Powerup.Duration -37 }
actor SamsaraPowerFakeInvulnerableGiverDeusEx3 : SamsaraPowerFakeInvulnerableGiver { Powerup.Duration -45 }
actor SamsaraPowerFakeInvulnerableGiverDeusEx4 : SamsaraPowerFakeInvulnerableGiver { Powerup.Duration -53 }
actor SamsaraPowerFakeInvulnerableGiverDeusEx5 : SamsaraPowerFakeInvulnerableGiver { Powerup.Duration -60 }

/*
actor InvulnTrail
{
    RenderStyle "Add"
    Alpha 0.4
    Scale 0.95
    +CLIENTSIDEONLY
    +NOINTERACTION
    States
    {
      Spawn:
        NVLN A 2 A_FadeOut(0.125)
        loop
    }
}
*/

// Environmental Protection
actor BioSuit : SamsaraPowerupPickup
{
    Inventory.PickupFlash "PickupFlash"
    Alpha 0.95
    States
    {
      Spawn:
        RDST A 0 Bright Light("SAMSARA_BIOSUIT")
        goto SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        TNT1 A 0 A_ChangeFlag("NOTIMEFREEZE",false)
      SpawnActualAnim:
        RDST A 35 Bright Light("SAMSARA_BIOSUIT") ACS_NamedExecuteAlways("SamsaraClientDecorate", 0, 4, 100, 95)
        loop

      Pickup:
        //TNT1 A 0 A_JumpIfInventory("StrifeClass",1,"PickupStrife") // Unused; it was kind of a dumb idea to make the radiation suit an inventory item anyway
        //TNT1 A 0 A_JumpIfInventory("WitchavenClass",1,"PickupWitchaven")
        //TNT1 A 0 A_JumpIfInventory("BittermanClass",1,"PickupQuake2")
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        goto PickupDisplay

      PickupStrife:
        TNT1 A 0 A_JumpIfInventory("PortEnviSuit",0,"PickupFail")
        goto PickupDisplay

      PickupWitchaven:
        TNT1 A 0 A_JumpIfInventory("WTFireProofPhial",0,"PickupFail")
        goto PickupDisplay

      PickupQuake2:
        TNT1 A 0 A_JumpIfInventory("Q2EnvironmentSuit",0,"PickupFail")
        goto PickupDisplay

      PickupDisplay:
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupDisplayMarathon")
        TNT1 A 0 A_JumpIfInventory("RottClass",1,"PickupDisplayROTT")
        //TNT1 A 0 A_JumpIfInventory("StrifeClass",1,"PickupDisplayStrife")
        //TNT1 A 0 A_JumpIfInventory("BittermanClass",1,"PickupDisplayQuake2")
        TNT1 A 0 A_JumpIfInventory("Q3Class",1,"PickupDisplayQuake3")
        TNT1 A 0 A_Jump(256,"PickupDisplayDefault") // for inheriting actors
        goto PickupDisplayDefault

      PickupDisplayDefault:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 3, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("antisterileget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayMarathon:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 3, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("marathon/bigitemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayROTT:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 3, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("gen/asbestos",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayStrife:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 3, 2)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("strife/itempickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayQuake2:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 3, 3)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("Q2Misc/Pickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayQuake3:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 3, 4)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 ACS_NamedExecuteAlways("Q3_Announcer", 0, 2) //A_PlaySound("Quake3/Items/BioSuit",CHAN_6)
        goto PickupSuccess

      PickupSuccess:
        TNT1 A 0 A_JumpIfInventory("DoomguyClass",1,"PickupSuccessDoom")
        TNT1 A 0 A_JumpIfInventory("RottClass",1,"PickupSuccessROTT")
        //TNT1 A 0 A_JumpIfInventory("StrifeClass",1,"PickupSuccessStrife")
        TNT1 A 0 A_JumpIfInventory("KatarnClass",1,"PickupSuccessDarkForces")
        TNT1 A 0 A_JumpIfInventory("WitchavenClass",1,"PickupSuccessWitchaven")
        //TNT1 A 0 A_JumpIfInventory("BittermanClass",1,"PickupSuccessQuake2")
        TNT1 A 0 A_JumpIfInventory("Q3Class",1,"PickupSuccessQuake3")
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"PickupSuccessDeusEx")
        TNT1 A 0 A_Jump(256,"PickupSuccessDefault") // for inheriting actors
        goto PickupSuccessDefault

      PickupSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerIronFeetGiver")
        stop

      PickupSuccessDoom:
        TNT1 A 0 A_JumpIfInventory("DoomClassMode",2,"PickupSuccessStronghold")
        TNT1 A 0 A_JumpIfInventory("DoomClassMode",1,"PickupSuccessDoom64")
        goto PickupSuccessDefault

      PickupSuccessDoom64:
        TNT1 A 0 A_GiveInventory("SamsaraPowerIronFeetGiverDoom64")
        stop

      PickupSuccessStronghold:
        goto PickupSuccessDefault

      PickupSuccessROTT:
        TNT1 A 0 A_JumpIfInventory("PowerIronFeetNoColor",1,"PickupSuccessROTTSubsequent")
        TNT1 A 0 A_TakeInventory("PowerBulletProofVest")
        TNT1 A 0 A_GiveInventory("SamsaraPowerIronFeetGiverROTT")
        TNT1 A 0 A_GiveInventory("AsbestosArmor")
        TNT1 A 0 ACS_NamedExecuteWithResult("RottGasMask")
        stop

      PickupSuccessROTTSubsequent:
        TNT1 A 0 A_TakeInventory("PowerBulletProofVest")
        TNT1 A 0 A_GiveInventory("SamsaraPowerIronFeetGiverROTT")
        TNT1 A 0 A_GiveInventory("AsbestosArmor")
        stop

      PickupSuccessStrife:
        TNT1 A 0 A_GiveInventory("PortEnviSuit")
        stop

      PickupSuccessDarkForces:
        TNT1 A 0 A_GiveInventory("SamsaraPowerIronFeetGiverNoColor")
        stop

      PickupSuccessWitchaven:
        TNT1 A 0 A_GiveInventory("SamsaraPowerIronFeetGiver")
        TNT1 A 0 A_GiveInventory("WTFireProofPhial")
        stop

      PickupSuccessQuake2:
        TNT1 A 0 A_GiveInventory("Q2EnvironmentSuit")
        stop

      PickupSuccessQuake3:
        TNT1 A 0 A_GiveInventory("Q3BattleSuitProtection")
        TNT1 A 0 A_GiveInventory("Q3BattleSuitIronFeet")
        stop

      PickupSuccessDeusEx:
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",0,"PickupSuccessDeusExMaster")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",3,"PickupSuccessDeusExAdvanced")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",2,"PickupSuccessDeusExProficient")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",1,"PickupSuccessDeusExTrained")
      PickupSuccessDeusExUntrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerIronFeetGiverDeusEx1")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExTrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerIronFeetGiverDeusEx2")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExProficient:
        TNT1 A 0 A_GiveInventory("SamsaraPowerIronFeetGiverDeusEx3")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExAdvanced:
        TNT1 A 0 A_GiveInventory("SamsaraPowerIronFeetGiverDeusEx4")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExMaster:
        TNT1 A 0 A_GiveInventory("SamsaraPowerIronFeetGiverDeusEx5")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExFinish:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 200)
        stop
    }
}

actor DoomBioSuit : BioSuit replaces RadSuit {}
actor ChexBioSuit : BioSuit replaces SlimeProofSuit {}

actor SamsaraPowerIronFeetGiver : SamsaraPowerupGiver { Powerup.Type "IronFeet" }
actor SamsaraPowerIronFeetGiverNoColor : SamsaraPowerupGiver { Powerup.Type "IronFeetNoColor" }
actor SamsaraPowerMaskGiver : SamsaraPowerupGiver { Powerup.Type "Mask" }

actor PowerIronFeetNoColor : PowerIronFeet { Powerup.Color "Green", 0 } // can't remove the color in PowerupGiver, so a powerup-inherited actor it is

actor SamsaraBioSuitInventory : CustomInventory
{
    Inventory.UseSound ""
    +INVBAR
    +UNDROPPABLE
    States
    {
      Use:
        TNT1 A 0 A_Jump(256,"UseDefault") // for inheriting actors
        goto UseDefault

      UseDefault:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 2, 0), "UseFail")
        goto UsePlaySound

      UsePlaySound:
        TNT1 A 0 A_JumpIfInventory("StrifeClass",1,"UsePlaySoundStrife")
        TNT1 A 0 A_Jump(256,"UsePlaySoundDefault") // for inheriting actors
        goto UsePlaySoundDefault

      UsePlaySoundDefault:
        goto UseSuccess

      UsePlaySoundStrife:
        TNT1 A 0 A_PlaySound("strife/itempickup",CHAN_ITEM)
        goto UseSuccess

      UseSuccess:
        TNT1 A 0 A_Jump(256,"UseSuccessDefault") // for inheriting actors
        goto UseSuccessDefault

      UseSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerIronFeetGiver")
        goto UseFinish

      UseFinish:
        TNT1 A 0 A_RailWait
        stop

      UseFail:
        TNT1 A 0
        fail
    }
}

actor SamsaraPowerIronFeetGiverDoom64 : SamsaraPowerIronFeetGiver { Powerup.Color "Green", 0.15 }

actor SamsaraPowerIronFeetGiverROTT : SamsaraPowerIronFeetGiverNoColor { Powerup.Duration -45 }

actor PortEnviSuit : SamsaraBioSuitInventory
{
    Inventory.Icon "I_GASM"
    Inventory.MaxAmount 5
    Inventory.InterHubAmount 5
    Inventory.RestrictedTo "StrifeguyPlayer"
    Tag "Environmental Suit"
}

actor WTFireProofPhial : PowerupGiver
{
    Inventory.UseSound "gplayer/drink"
    Inventory.Icon "WIN0D0"
    Inventory.MaxAmount 10
    Inventory.InterHubAmount 10
    Inventory.RestrictedTo "GrondovalPlayer"
    Powerup.Type "WTFireProof"
    Powerup.Color "OrangeRed", 0.25
    Tag "Fire Immunity Potion"
    +UNDROPPABLE
}

actor PowerWTFireProof : PowerProtection
{
    Powerup.Duration -30
    DamageFactor "Fire", 0
    DamageFactor "MarathonFire", 0
    DamageFactor "MarathonPlasmaFire", 0
    DamageFactor "WolfenFlamethrower", 0
    DamageFactor "TotenkopfFire", 0
    DamageFactor "CalebFire", 0
    DamageFactor "LifeLeech", 0
    DamageFactor "FireExplosive", 0
    DamageFactor "Hexen2Fire", 0
    DamageFactor "DoomDamageTypeFire", 0
    DamageFactor "DoomDamageTypeFireExplosive", 0
    DamageFactor "RottFire", 0
    DamageFactor "WTRangedFire", 0
    DamageFactor "DeusExFlamed", 0
    DamageFactor "PSFire", 0
    DamageFactor "SWFlame", 0
    DamageFactor "PGFire", 0
    DamageFactor "PainkillerFire", 0
    DamageFactor "QuakeFire", 0
    DamageFactor "RTCWFire", 0
    DamageFactor "HexGreenFire", 0
    DamageFactor "HexenQuietusFire", 0
    DamageFactor "PhosFire", 0
    DamageFactor "PhosFireCoop", 0
    DamageFactor "EradGreenFire", 0
    DamageFactor "EradCoopGreenFire", 0
    DamageFactor "SWFlame", 0
    DamageFactor "SWFlame2", 0
    DamageFactor "SWFlame2Coop", 0
    DamageFactor "SWFlame3", 0
}

actor SamsaraPowerIronFeetGiverDeusEx1 : SamsaraPowerIronFeetGiver {}
actor SamsaraPowerIronFeetGiverDeusEx2 : SamsaraPowerIronFeetGiver { Powerup.Duration -75 }
actor SamsaraPowerIronFeetGiverDeusEx3 : SamsaraPowerIronFeetGiver { Powerup.Duration -90 }
actor SamsaraPowerIronFeetGiverDeusEx4 : SamsaraPowerIronFeetGiver { Powerup.Duration -105 }
actor SamsaraPowerIronFeetGiverDeusEx5 : SamsaraPowerIronFeetGiver { Powerup.Duration -120 }

/*
actor BioTrail
{
    RenderStyle "Add"
    Alpha 0.4
    Scale 0.95
    +CLIENTSIDEONLY
    +NOINTERACTION
    States
    {
      Spawn:
        RDST A 2 A_FadeOut(0.125)
        loop
    }
}
*/

// Light Amplification
actor Visor : SamsaraPowerupPickup
{
    Inventory.PickupFlash "PickupFlash"
    Alpha 0.85
    States
    {
      Spawn:
        VISR A 0 Bright Light("SAMSARA_VISOR") NoDelay ACS_NamedExecuteWithResult("Samsara_SwitchableObject", 22)
      SpawnDropCheck:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 1, 1), 1)
        goto SpawnGameModeCheck
        TNT1 A 0 A_ChangeFlag("COUNTITEM",false)
        goto SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        TNT1 A 0 A_ChangeFlag("NOTIMEFREEZE",false)
      SpawnActualAnim:
        VISR A 20 Bright Light("SAMSARA_VISOR") ACS_NamedExecuteAlways("SamsaraClientDecorate", 0, 4, 100, 85)
        VISR A 20 Light("SAMSARA_VISOR")
        loop

      Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupHexen1")
        TNT1 A 0 A_JumpIfInventory("DukeClass",1,"PickupDuke")
        TNT1 A 0 A_JumpIfInventory("CalebClass",1,"PickupBlood")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"PickupPowerSlave")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"PickupHexen2")
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        goto PickupDisplay

      PickupHeretic:
        TNT1 A 0 A_JumpIfInventory("PortTorch",0,"PickupFail")
        goto PickupDisplay

      PickupHexen1:
        goto PickupHeretic

      PickupDuke:
        TNT1 A 0 A_JumpIfInventory("DukePortNiVi",1,3)
        TNT1 A 0 A_JumpIfInventory("DukePortNiViLAB",1,2)
        TNT1 A 0 A_JumpIfInventory("DukePortNiVi64",1,1)
        goto PickupDisplay
        TNT1 A 0 A_JumpIfInventory("DukeVisionFuel",0,"PickupFail")
        goto PickupDisplay

      PickupBlood:
        TNT1 A 0 A_JumpIfInventory("BeastVision",1,1)
        goto PickupDisplay
        TNT1 A 0 A_JumpIfInventory("CalebVisionFuel",0,"PickupFail")
        goto PickupDisplay

      PickupPowerSlave:
        TNT1 A 0 A_JumpIfInventory("LighterofGumercindo_EX",0,"PickupFail")
        goto PickupDisplay

      PickupHexen2:
        TNT1 A 0 A_JumpIfInventory("PortTorch3",0,"PickupFail")
        goto PickupDisplay

      PickupDisplay:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupDisplayHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupDisplayHexen1")
        TNT1 A 0 A_JumpIfInventory("DukeClass",1,"PickupDisplayDuke")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupDisplayMarathon")
        TNT1 A 0 A_JumpIfInventory("RottClass",1,"PickupDisplayROTT")
        TNT1 A 0 A_JumpIfInventory("CalebClass",1,"PickupDisplayBlood")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"PickupDisplayPowerSlave")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"PickupDisplayHexen2")
        TNT1 A 0 A_Jump(256,"PickupDisplayDefault") // for inheriting actors
        goto PickupDisplayDefault

      PickupDisplayDefault:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 5, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("lettherebelight",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayHeretic:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 5, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayHexen1:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 5, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("hexen/artiget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayDuke:
        TNT1 A 0 A_JumpIfInventory("DukeClassMode",2,2)
        TNT1 A 0 A_JumpIfInventory("DukeClassMode",1,"PickupDisplayDukeLAB")
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 5, 2)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("duke/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayDukeLAB:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 5, 3)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("duke/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayMarathon:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 5, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("marathon/bigitemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayROTT:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 5, 4)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("gen/vest",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayBlood:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 5, 5)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("Caleb/Weapup02",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayPowerSlave:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 5, 6)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("Jon/NoramItemPick",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayHexen2:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 5, random(7,8))
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("Hexen2/ArtifactPickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupSuccessHexen1")
        TNT1 A 0 A_JumpIfInventory("DukeClass",1,"PickupSuccessDuke")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupSuccessMarathon")
        TNT1 A 0 A_JumpIfInventory("RottClass",1,"PickupSuccessROTT")
        TNT1 A 0 A_JumpIfInventory("CalebClass",1,"PickupSuccessBlood")
        TNT1 A 0 A_JumpIfInventory("KatarnClass",1,"PickupSuccessDarkForces")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"PickupSuccessPowerSlave")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"PickupSuccessHexen2")
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"PickupSuccessDeusEx")
        TNT1 A 0 A_Jump(256,"PickupSuccessDefault") // for inheriting actors
        goto PickupSuccessDefault

      PickupSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLightAmpGiver")
        stop

      PickupSuccessHeretic:
        TNT1 A 0 A_GiveInventory("PortTorch")
        stop

      PickupSuccessHexen1:
        goto PickupSuccessHeretic

      PickupSuccessDuke:
        TNT1 A 0 A_GiveInventory("DukeVisionFuel",100)
        TNT1 A 0 A_JumpIfInventory("DukeClassMode",2,"PickupSuccessDuke64")
        TNT1 A 0 A_JumpIfInventory("DukeClassMode",1,"PickupSuccessDukeLAB")
        TNT1 A 0 A_GiveInventory("DukePortNiVi")
        stop

      PickupSuccessDukeLAB:
        TNT1 A 0 A_GiveInventory("DukePortNiViLAB")
        stop

      PickupSuccessDuke64:
        TNT1 A 0 A_GiveInventory("DukePortNiVi64")
        stop

      PickupSuccessMarathon:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLightAmpGiverMarathon")
        stop

      PickupSuccessROTT:
        TNT1 A 0 A_TakeInventory("PowerIronFeetNoColor")
        TNT1 A 0 A_TakeInventory("PowerAsbestosArmor")
        TNT1 A 0 A_GiveInventory("SamsaraPowerLightAmpGiver")
        TNT1 A 0 A_GiveInventory("BulletProofVest")
        stop

      PickupSuccessBlood:
        TNT1 A 0 A_GiveInventory("CalebVisionFuel",100)
        TNT1 A 0 A_GiveInventory("BeastVision")
        stop

      PickupSuccessDarkForces:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLightAmpGiverDarkForces")
        stop

      PickupSuccessPowerSlave:
        TNT1 A 0 A_GiveInventory("LighterofGumercindo_EX")
        stop

      PickupSuccessHexen2:
        TNT1 A 0 A_GiveInventory("PortTorch3")
        stop

      PickupSuccessDeusEx:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 23)
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",0,"PickupSuccessDeusExMaster")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",3,"PickupSuccessDeusExAdvanced")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",2,"PickupSuccessDeusExProficient")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",1,"PickupSuccessDeusExTrained")
      PickupSuccessDeusExUntrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLightAmpGiverDeusEx1")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExTrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLightAmpGiverDeusEx2")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExProficient:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLightAmpGiverDeusEx3")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExAdvanced:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLightAmpGiverDeusEx4")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExMaster:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLightAmpGiverDeusEx5")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExFinish:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 150)
        stop
    }
}

actor DoomVisor : Visor replaces Infrared { +COUNTITEM }

actor ChexVisor : Visor 2045 //replaces UltraGoggles
{
    Game Chex
    SpawnID 138
    +COUNTITEM
}

actor RavenVisor : Visor replaces ArtiTorch { +COUNTITEM }

actor SamsaraPowerLightAmpGiver : SamsaraPowerupGiver { Powerup.Type "LightAmp" }
actor SamsaraPowerTorchGiver : SamsaraPowerupGiver { Powerup.Type "Torch" }

actor SamsaraVisorInventory : CustomInventory
{
    Inventory.UseSound ""
    +INVBAR
    +UNDROPPABLE
    States
    {
      Use:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UseHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UseHexen1")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"UsePowerSlave")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"UseHexen2")
        TNT1 A 0 A_Jump(256,"UseDefault") // for inheriting actors
        goto UseDefault

      UseDefault:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 3, 0), "UseFail")
        goto UsePlaySound

      UseHeretic:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 3, 1), "UseFail")
        goto UsePlaySound

      UseHexen1:
        goto UseHeretic

      UsePowerSlave:
        goto UseHeretic

      UseHexen2:
        goto UseHeretic

      UsePlaySound:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UsePlaySoundHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UsePlaySoundHexen1")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"UsePlaySoundPowerSlave")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"UsePlaySoundHexen2")
        TNT1 A 0 A_Jump(256,"UsePlaySoundDefault") // for inheriting actors
        goto UsePlaySoundDefault

      UsePlaySoundDefault:
        goto UseSuccess

      UsePlaySoundHeretic:
        TNT1 A 0 A_PlaySound("heretic/itemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHexen1:
        TNT1 A 0 A_PlaySound("hexen/artiuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundPowerSlave:
        TNT1 A 0 A_PlaySound("Jon/itemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHexen2:
        TNT1 A 0 A_PlaySound("Hexen2/ArtiUse",CHAN_ITEM)
        goto UseSuccess

      UseSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UseSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UseSuccessHexen1")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"UseSuccessPowerSlave")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"UseSuccessHexen2")
        TNT1 A 0 A_Jump(256,"UseSuccessDefault") // for inheriting actors
        goto UseSuccessDefault

      UseSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLightAmpGiver")
        goto UseFinish

      UseSuccessHeretic:
        TNT1 A 0 A_GiveInventory("SamsaraPowerTorchGiver")
        goto UseFinish

      UseSuccessHexen1:
        goto UseSuccessHeretic

      UseSuccessPowerSlave:
        goto UseSuccessHeretic

      UseSuccessHexen2:
        goto UseSuccessHeretic

      UseFinish:
        TNT1 A 0 A_RailWait
        stop

      UseFail:
        TNT1 A 0
        fail
    }
}

actor PortTorch : SamsaraVisorInventory
{
    Inventory.Icon "ARTITRCH"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.RestrictedTo "CorvusPlayer", "HexenPlayer"
    Tag "Torch"
}

actor SamsaraPowerLightAmpGiverMarathon : SamsaraPowerLightAmpGiver { Powerup.Color "BlueMap" }

actor SamsaraPowerLightAmpGiverDarkForces : SamsaraPowerLightAmpGiver { Powerup.Colormap 0.0, 0.0, 0.0, 0.0, 1.0, 0.0 }

actor LighterofGumercindo_EX : SamsaraVisorInventory
{
    Inventory.Icon "_EX3D0"
    Inventory.MaxAmount 6
    Inventory.InterHubAmount 6
    Inventory.RestrictedTo "PSPlayer"
    Tag "Lighter of Gumercindo"
}

actor PortTorch3 : SamsaraVisorInventory
{
    Inventory.Icon "H2INVT03"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.RestrictedTo "Demoness"
    Tag "Torch"
}

actor SamsaraPowerLightAmpGiverDeusEx1 : SamsaraPowerLightAmpGiver {}
actor SamsaraPowerLightAmpGiverDeusEx2 : SamsaraPowerLightAmpGiver { Powerup.Duration -150 }
actor SamsaraPowerLightAmpGiverDeusEx3 : SamsaraPowerLightAmpGiver { Powerup.Duration -180 }
actor SamsaraPowerLightAmpGiverDeusEx4 : SamsaraPowerLightAmpGiver { Powerup.Duration -210 }
actor SamsaraPowerLightAmpGiverDeusEx5 : SamsaraPowerLightAmpGiver { Powerup.Duration -240 }

/*
actor VisorTrail
{
    RenderStyle "Add"
    Alpha 0.4
    Scale 0.95
    +CLIENTSIDEONLY
    +NOINTERACTION
    States
    {
      Spawn:
        VISR A 2 A_FadeOut(0.125)
        loop
    }
}
*/

// Map
actor SamsaraAllmap : SamsaraPowerupPickup
{
    Inventory.PickupFlash "PickupFlash"
    Alpha 0.85
    States
    {
      Spawn:
        AMAP A 0 Bright NoDelay ACS_NamedExecuteWithResult("Samsara_SwitchableObject", 14)
      SpawnDropCheck:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 1, 1), 1)
        goto SpawnGameModeCheck
        TNT1 A 0 A_ChangeFlag("COUNTITEM",false)
        goto SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        TNT1 A 0 A_ChangeFlag("NOTIMEFREEZE",false)
      SpawnActualAnim:
        AMAP ABCDCB 6 Bright //A_SpawnItemEx("VisorTrail",0,0,2.5,0,0,0,0,128)
        loop

      Pickup:
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        goto PickupDisplay

      PickupDisplay:
        TNT1 A 0 A_Jump(256,"PickupDisplayDefault") // for inheriting actors
        goto PickupDisplayDefault

      PickupDisplayDefault:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 6, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("igotamap",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupSuccess:
        TNT1 A 0 A_Jump(256,"PickupSuccessDefault") // for inheriting actors
        goto PickupSuccessDefault

      PickupSuccessDefault:
        TNT1 A 0 A_GiveInventory("Allmap")
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraMapRevealerPickup")
        stop
    }
}

actor SamsaraDoomAllmap : SamsaraAllmap replaces Allmap { +COUNTITEM }
actor SamsaraChexAllmap : SamsaraAllmap replaces ComputerAreaMap { +COUNTITEM }
actor SamsaraHereticAllmap : SamsaraAllmap replaces SuperMap { +COUNTITEM }

// Heretic Powerups

// Strength
actor SamsaraLesserTome : SamsaraPowerupPickup
{
    Inventory.PickupFlash "PickupFlash"
    RenderStyle "Normal"
    //Alpha 0.95
    Scale 0.5
    States
    {
      Spawn:
        CPRT J 0 Bright Light("SAMSARA_HERETICSTRENGTH")
      SpawnDropCheck:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 1, 1), 1)
        goto SpawnGameModeCheck
        TNT1 A 0 A_ChangeFlag("COUNTITEM",false)
        goto SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        CPRT J -1 Bright Light("SAMSARA_HERETICSTRENGTH") A_ChangeFlag("NOTIMEFREEZE",false)
        stop

      Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupHexen1")
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        TNT1 A 0 A_JumpIfInventory("SamsaraLesserTomeInventory",0,"PickupFail")
        goto PickupDisplay

      PickupHeretic:
        TNT1 A 0 A_JumpIfInventory("SamsaraLesserTomeInventoryRaven",0,"PickupFail")
        goto PickupDisplay

      PickupHexen1:
        goto PickupHeretic

      PickupDisplay:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupDisplayHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupDisplayHexen1")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupDisplayMarathon")
        TNT1 A 0 A_Jump(256,"PickupDisplayDefault") // for inheriting actors
        goto PickupDisplayDefault

      PickupDisplayDefault:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 16, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("tome/lesser",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 9)
        goto PickupSuccess

      PickupDisplayHeretic:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 16, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 9)
        goto PickupSuccess

      PickupDisplayHexen1:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 16, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("hexen/artiget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 9)
        goto PickupSuccess

      PickupDisplayMarathon:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 16, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("marathon/bigitemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 9)
        goto PickupSuccess

      PickupSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupSuccessHexen1")
        TNT1 A 0 A_Jump(256,"PickupSuccessDefault") // for inheriting actors
        goto PickupSuccessDefault

      PickupSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraLesserTomeInventory")
        stop

      PickupSuccessHeretic:
        TNT1 A 0 A_GiveInventory("SamsaraLesserTomeInventoryRaven")
        stop

      PickupSuccessHexen1:
        goto PickupSuccessHeretic
    }
}

actor SamsaraHereticLesserTome : SamsaraLesserTome replaces ArtiTomeOfPower { +COUNTITEM }

actor SamsaraPowerLesserTomeGiver : SamsaraPowerupGiver
{
    Powerup.Type "SamsaraLesserTome"
    Powerup.Color "Red", 0.1
}

actor PowerSamsaraLesserTome : PowerDamage
{
    Powerup.Duration -30
    DamageFactor "Normal", 2
}

actor SamsaraLesserTomeInventory : CustomInventory
{
    Inventory.UseSound ""
    Inventory.Icon "ARTIPWR1"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.ForbiddenTo "CorvusPlayer", "HexenPlayer"
    Tag "Strength"
    +INVBAR
    +UNDROPPABLE
    States
    {
      Use:
        TNT1 A 0 A_Jump(256,"UseDefault") // for inheriting actors
        goto UseDefault

      UseDefault:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 5, 0), "UseFail")
        goto UsePlaySound

      UsePlaySound:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UsePlaySoundHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UsePlaySoundHexen1")
        TNT1 A 0 A_Jump(256,"UsePlaySoundDefault") // for inheriting actors
        goto UsePlaySoundDefault

      UsePlaySoundDefault:
        TNT1 A 0 A_PlaySound("samsaraitemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHeretic:
        TNT1 A 0 A_PlaySound("heretic/itemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHexen1:
        TNT1 A 0 A_PlaySound("hexen/artiuse",CHAN_ITEM)
        goto UseSuccess

      UseSuccess:
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"UseSuccessDeusEx")
        TNT1 A 0 A_Jump(256,"UseSuccessDefault") // for inheriting actors
        goto UseSuccessDefault

      UseSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLesserTomeGiver")
        goto UseFinish

      UseSuccessDeusEx:
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",0,"UseSuccessDeusExMaster")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",3,"UseSuccessDeusExAdvanced")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",2,"UseSuccessDeusExProficient")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",1,"UseSuccessDeusExTrained")
      UseSuccessDeusExUntrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLesserTomeGiverDeusEx1")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExTrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLesserTomeGiverDeusEx2")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExProficient:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLesserTomeGiverDeusEx3")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExAdvanced:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLesserTomeGiverDeusEx4")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExMaster:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLesserTomeGiverDeusEx5")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExFinish:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 150)
        goto UseFinish

      UseFinish:
        TNT1 A 0 A_RailWait
        stop

      UseFail:
        TNT1 A 0
        fail
    }
}

actor SamsaraLesserTomeInventoryRaven : SamsaraLesserTomeInventory
{
    Inventory.Icon "ARTITOM2"
    Inventory.RestrictedTo "CorvusPlayer", "HexenPlayer"
    Tag "Novice's Tome of Strength"
}

actor SamsaraPowerLesserTomeGiverDeusEx1 : SamsaraPowerLesserTomeGiver {}
actor SamsaraPowerLesserTomeGiverDeusEx2 : SamsaraPowerLesserTomeGiver { Powerup.Duration -37 }
actor SamsaraPowerLesserTomeGiverDeusEx3 : SamsaraPowerLesserTomeGiver { Powerup.Duration -45 }
actor SamsaraPowerLesserTomeGiverDeusEx4 : SamsaraPowerLesserTomeGiver { Powerup.Duration -53 }
actor SamsaraPowerLesserTomeGiverDeusEx5 : SamsaraPowerLesserTomeGiver { Powerup.Duration -60 }

// Teleportation
actor SamsaraTeleportPickup : SamsaraPowerupPickup
{
    Inventory.PickupFlash "PickupFlash"
    RenderStyle "Normal"
    //Alpha 0.95
    Scale 0.5
    States
    {
      Spawn:
        CPRT I 0 Bright Light("SAMSARA_TELEPORTATION") NoDelay ACS_NamedExecuteWithResult("Samsara_SwitchableObject", 24)
      SpawnDropCheck:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 1, 1), 1)
        goto SpawnGameModeCheck
        TNT1 A 0 A_ChangeFlag("COUNTITEM",false)
        goto SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        CPRT I -1 Bright Light("SAMSARA_TELEPORTATION") A_ChangeFlag("NOTIMEFREEZE",false)
        stop

      Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupHexen1")
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        TNT1 A 0 A_JumpIfInventory("SamsaraTeleportPickupInventory",0,"PickupFail")
        goto PickupDisplay

      PickupHeretic:
        TNT1 A 0 A_JumpIfInventory("SamsaraTeleportPickupInventoryHeretic",0,"PickupFail")
        goto PickupDisplay

      PickupHexen1:
        TNT1 A 0 A_JumpIfInventory("SamsaraTeleportPickupInventoryHexen1",0,"PickupFail")
        goto PickupDisplay

      PickupDisplay:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupDisplayHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupDisplayHexen1")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupDisplayMarathon")
        TNT1 A 0 A_Jump(256,"PickupDisplayDefault") // for inheriting actors
        goto PickupDisplayDefault

      PickupDisplayDefault:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 15, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("teleportpickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayHeretic:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 15, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayHexen1:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 15, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("hexen/artiget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayMarathon:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 15, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("marathon/bigitemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupSuccessHexen1")
        TNT1 A 0 A_Jump(256,"PickupSuccessDefault") // for inheriting actors
        goto PickupSuccessDefault

      PickupSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraTeleportPickupInventory")
        stop

      PickupSuccessHeretic:
        TNT1 A 0 A_GiveInventory("SamsaraTeleportPickupInventoryHeretic")
        stop

      PickupSuccessHexen1:
        TNT1 A 0 A_GiveInventory("SamsaraTeleportPickupInventoryHexen1")
        stop
    }
}

actor SamsaraRavenTeleportPickup : SamsaraTeleportPickup replaces ArtiTeleport { +COUNTITEM }

actor SamsaraTeleportPickupInventory : CustomInventory
{
    Inventory.UseSound ""
    Inventory.Icon "ARTITEL1"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.ForbiddenTo "CorvusPlayer", "HexenPlayer"
    Tag "Teleportation"
    +INVBAR
    +UNDROPPABLE
    States
    {
      Use:
        TNT1 A 0 A_Jump(256,"UseDefault") // for inheriting actors
        goto UseDefault

      UseDefault:
        goto UsePlaySound

      UsePlaySound:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UsePlaySoundHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UsePlaySoundHexen1")
        TNT1 A 0 A_Jump(256,"UsePlaySoundDefault") // for inheriting actors
        goto UsePlaySoundDefault

      UsePlaySoundDefault:
        TNT1 A 0 A_PlaySound("samsaraitemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHeretic:
        TNT1 A 0 A_PlaySound("heretic/itemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHexen1:
        TNT1 A 0 A_PlaySound("hexen/artiuse",CHAN_ITEM)
        goto UseSuccess

      UseSuccess:
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"UseSuccessDeusEx")
        TNT1 A 0 A_Jump(256,"UseSuccessDefault") // for inheriting actors
        goto UseSuccessDefault

      UseSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraTeleportPickupInventoryEffect")
        goto UseFinish

      UseSuccessDeusEx:
        TNT1 A 0 A_GiveInventory("SamsaraTeleportPickupInventoryEffect")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExFinish:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 150)
        goto UseFinish

      UseFinish:
        TNT1 A 0 A_RailWait
        stop

      UseFail:
        TNT1 A 0
        fail
    }
}

actor SamsaraTeleportPickupInventoryHeretic : SamsaraTeleportPickupInventory
{
    Inventory.Icon "ARTITEL2"
    Inventory.RestrictedTo "CorvusPlayer"
    Tag "Chaos Device"
}

actor SamsaraTeleportPickupInventoryHexen1 : SamsaraTeleportPickupInventory
{
    Inventory.Icon "ARTITEL3"
    Inventory.RestrictedTo "HexenPlayer"
    Tag "Chaos Device"
}

actor SamsaraTeleportPickupInventoryEffect : ArtiTeleport
{
    Inventory.UseSound ""
    Inventory.MaxAmount 1
    +ALWAYSPICKUP
    +AUTOACTIVATE
    -INVBAR
}

// Flight
actor SamsaraFlightPickup : SamsaraPowerupPickup
{
    Inventory.PickupFlash "PickupFlash"
    RenderStyle "Normal"
    //Alpha 0.95
    Scale 0.5
    States
    {
      Spawn:
        CPRT K 0 Bright Light("SAMSARA_FLIGHT")
      SpawnDropCheck:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 49) == 8, 2) // check if hexen is being played regardless of TOSSED
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 1, 1), 1)
        goto SpawnGameModeCheck
        TNT1 A 0 A_ChangeFlag("COUNTITEM",false)
        goto SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        CPRT K -1 Bright Light("SAMSARA_FLIGHT") A_ChangeFlag("NOTIMEFREEZE",false)
        stop

      Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupHexen1")
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        TNT1 A 0 A_JumpIfInventory("SamsaraFlightPickupInventory",0,"PickupFail")
        goto PickupDisplay

      PickupHeretic:
        TNT1 A 0 A_JumpIfInventory("SamsaraFlightPickupInventoryRaven",0,"PickupFail")
        goto PickupDisplay

      PickupHexen1:
        goto PickupHeretic

      PickupDisplay:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupDisplayHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupDisplayHexen1")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupDisplayMarathon")
        TNT1 A 0 A_Jump(256,"PickupDisplayDefault") // for inheriting actors
        goto PickupDisplayDefault

      PickupDisplayDefault:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 14, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("flightpickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayHeretic:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 14, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayHexen1:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 14, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("hexen/artiget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayMarathon:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 14, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("marathon/bigitemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupSuccessHexen1")
        TNT1 A 0 A_Jump(256,"PickupSuccessDefault") // for inheriting actors
        goto PickupSuccessDefault

      PickupSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraFlightPickupInventory")
        stop

      PickupSuccessHeretic:
        TNT1 A 0 A_GiveInventory("SamsaraFlightPickupInventoryRaven")
        stop

      PickupSuccessHexen1:
        goto PickupSuccessHeretic
    }
}

actor SamsaraRavenFlightPickup : SamsaraFlightPickup replaces ArtiFly { +COUNTITEM }

actor SamsaraPowerFlightGiver : SamsaraPowerupGiver
{
    Powerup.Type "SamsaraFlight"
    Powerup.Color "Yellow", 0.1
}

actor PowerSamsaraFlight : PowerFlight { Inventory.Icon "TNT1A0" } // can't use ""

// Online games need this because for some reason, the powerup won't
// last forever in Hexen netgames like it's supposed to.
actor SamsaraPowerFlightGiverInfinite : SamsaraPowerFlightGiver
{
    Powerup.Duration 0x7FFFFFFD
    Powerup.Color "Yellow", 0
}

actor SamsaraPowerFlightInfiniteHUDDummyGiver : SamsaraPowerupGiver { Powerup.Type "SamsaraFlightInfiniteHUDDummy" } // in case some custom HUD wants to hide the timer for hexen

actor PowerSamsaraFlightInfiniteHUDDummy : Powerup
{
    Powerup.Duration 0x7FFFFFFD
    +HUBPOWER
}

actor SamsaraFlightPickupInventory : CustomInventory
{
    Inventory.UseSound ""
    Inventory.Icon "ARTISOR1"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.ForbiddenTo "CorvusPlayer", "HexenPlayer"
    Tag "Flight"
    +INVBAR
    +UNDROPPABLE
    States
    {
      Use:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UseHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UseHexen1")
        TNT1 A 0 A_JumpIfInventory("DescentClass",1,"UseDescent")
        TNT1 A 0 A_Jump(256,"UseDefault") // for inheriting actors
        goto UseDefault

      UseDefault:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 6, 0), "UseFail")
        goto UsePlaySound

      UseHeretic:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 6, 1), "UseFail")
        goto UsePlaySound

      UseHexen1:
        goto UseHeretic

      UseDescent:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 54) >= 1, 1)
        goto UseDefault
        TNT1 A 0 // placeholder
        goto UsePlaySound

      UsePlaySound:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UsePlaySoundHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UsePlaySoundHexen1")
        TNT1 A 0 A_Jump(256,"UsePlaySoundDefault") // for inheriting actors
        goto UsePlaySoundDefault

      UsePlaySoundDefault:
        TNT1 A 0 A_PlaySound("samsaraitemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHeretic:
        TNT1 A 0 A_PlaySound("heretic/itemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHexen1:
        TNT1 A 0 A_PlaySound("hexen/artiuse",CHAN_ITEM)
        goto UseSuccess

      UseSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UseSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UseSuccessHexen1")
        TNT1 A 0 A_JumpIfInventory("DukeClass",1,"UseSuccessDuke")
        TNT1 A 0 A_JumpIfInventory("RMRClass",1,"UseSuccessRMR")
        TNT1 A 0 A_JumpIfInventory("WitchavenClass",1,"UseSuccessWitchaven")
        TNT1 A 0 A_JumpIfInventory("DescentClass",1,"UseSuccessDescent")
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"UseSuccessDeusEx")
        TNT1 A 0 A_Jump(256,"UseSuccessDefault") // for inheriting actors
        goto UseSuccessDefault

      UseSuccessDefault:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 49) == 8, "UseSuccessDefaultInfinite")
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightGiver")
        goto UseFinish

      UseSuccessDefaultInfinite:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightGiverInfinite")
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightInfiniteHUDDummyGiver")
        goto UseFinish

      UseSuccessHeretic:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 49) == 8, "UseSuccessHereticInfinite")
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightGiverRaven")
        goto UseFinish

      UseSuccessHereticInfinite:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightGiverRavenInfinite")
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightInfiniteHUDDummyGiver")
        goto UseFinish

      UseSuccessHexen1:
        goto UseSuccessHeretic

      UseSuccessDuke:
        TNT1 A 0 A_JumpIfInventory("DukeFlying",1,1)
        goto UseSuccessDefault
        TNT1 A 0 A_PlaySound("duke/jetpackoff",CHAN_ITEM)
        TNT1 A 0 A_GiveInventory("DukeJetpackIdleSoundStopper")
        TNT1 A 0 A_TakeInventory("DukeFlying")
        TNT1 A 0 A_TakeInventory("DukePetjack")
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteInventory",1,"UseSuccessDefault")
        TNT1 A 0 A_TakeInventory("DukeJetpackFuel",1)
        TNT1 A 0 A_JumpIfInventory("DukeJetpackFuel",1,"UseSuccessDefault")
      UseSuccessDukeDepleted:
        TNT1 A 0 A_TakeInventory("DukePortJetpack")
        TNT1 A 0 A_TakeInventory("DukePortJetpack64")
        goto UseSuccessDefault

      UseSuccessRMR:
        TNT1 A 0 A_TakeInventory("PowerRMRFlyAbility")
        TNT1 A 0 A_TakeInventory("PowerRMRFlyAbilityHack")
        goto UseSuccessDefault

      UseSuccessWitchaven:
        TNT1 A 0 A_TakeInventory("PowerWTSpellFly")
        TNT1 A 0 A_TakeInventory("PowerWTSpellFlyHack")
        goto UseSuccessDefault

      UseSuccessDescent:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 54) >= 1, 1)
        goto UseSuccessDefault
        TNT1 A 0 A_GiveInventory("DescentLaserLevel") // placeholder
        goto UseFinish

      UseSuccessDeusEx:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 49) == 8, "UseSuccessDeusExInfinite")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",0,"UseSuccessDeusExMaster")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",3,"UseSuccessDeusExAdvanced")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",2,"UseSuccessDeusExProficient")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",1,"UseSuccessDeusExTrained")
      UseSuccessDeusExUntrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightGiverDeusEx1")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExTrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightGiverDeusEx2")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExProficient:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightGiverDeusEx3")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExAdvanced:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightGiverDeusEx4")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExMaster:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightGiverDeusEx5")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExInfinite:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightGiverInfinite")
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightInfiniteHUDDummyGiver")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExFinish:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 200)
        goto UseFinish

      UseFinish:
        TNT1 A 0 A_RailWait
        stop

      UseFail:
        TNT1 A 0
        fail
    }
}

actor SamsaraFlightPickupInventoryRaven : SamsaraFlightPickupInventory
{
    Inventory.Icon "ARTISOR2"
    Inventory.RestrictedTo "CorvusPlayer", "HexenPlayer"
    Tag "Wings of Wrath"
}

actor SamsaraPowerFlightGiverRaven : SamsaraPowerupGiver { Powerup.Type "SamsaraFlightRaven" }

actor PowerSamsaraFlightRaven : PowerFlight { Inventory.Icon "HERFLY0" }

actor SamsaraPowerFlightGiverDeusEx1 : SamsaraPowerFlightGiver {}
actor SamsaraPowerFlightGiverDeusEx2 : SamsaraPowerFlightGiver { Powerup.Duration -75 }
actor SamsaraPowerFlightGiverDeusEx3 : SamsaraPowerFlightGiver { Powerup.Duration -90 }
actor SamsaraPowerFlightGiverDeusEx4 : SamsaraPowerFlightGiver { Powerup.Duration -105 }
actor SamsaraPowerFlightGiverDeusEx5 : SamsaraPowerFlightGiver { Powerup.Duration -120 }

actor SamsaraPowerFlightGiverRavenInfinite : SamsaraPowerFlightGiverRaven { Powerup.Duration 0x7FFFFFFD }

// Hexen Powerups

// Haste
actor SamsaraSpeedBootsPickup : SamsaraPowerupPickup
{
    Inventory.PickupFlash "PickupFlash"
    RenderStyle "Normal"
    //Alpha 0.95
    Scale 0.5
    States
    {
      Spawn:
        CPRT H 0 Bright Light("SAMSARA_HEXENHASTE")
      SpawnDropCheck:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 1, 1), 1)
        goto SpawnGameModeCheck
        TNT1 A 0 A_ChangeFlag("COUNTITEM",false)
        goto SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        CPRT H -1 Bright Light("SAMSARA_HEXENHASTE") A_ChangeFlag("NOTIMEFREEZE",false)
        stop

      Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupHexen1")
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        TNT1 A 0 A_JumpIfInventory("SamsaraSpeedBootsPickupInventory",0,"PickupFail")
        goto PickupDisplay

      PickupHeretic:
        TNT1 A 0 A_JumpIfInventory("SamsaraSpeedBootsPickupInventoryRaven",0,"PickupFail")
        goto PickupDisplay

      PickupHexen1:
        goto PickupHeretic

      PickupDisplay:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupDisplayHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupDisplayHexen1")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupDisplayMarathon")
        TNT1 A 0 A_Jump(256,"PickupDisplayDefault") // for inheriting actors
        goto PickupDisplayDefault

      PickupDisplayDefault:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 19, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("hexenbootspickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 10)
        goto PickupSuccess

      PickupDisplayHeretic:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 19, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 10)
        goto PickupSuccess

      PickupDisplayHexen1:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 19, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("hexen/artiget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 10)
        goto PickupSuccess

      PickupDisplayMarathon:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 19, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("marathon/bigitemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 10)
        goto PickupSuccess

      PickupSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupSuccessHexen1")
        TNT1 A 0 A_Jump(256,"PickupSuccessDefault") // for inheriting actors
        goto PickupSuccessDefault

      PickupSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraSpeedBootsPickupInventory")
        stop

      PickupSuccessHeretic:
        TNT1 A 0 A_GiveInventory("SamsaraSpeedBootsPickupInventoryRaven")
        stop

      PickupSuccessHexen1:
        goto PickupSuccessHeretic
    }
}

actor SamsaraHexenSpeedBootsPickup : SamsaraSpeedBootsPickup replaces ArtiSpeedBoots { +COUNTITEM }

actor SamsaraPowerSpeedBootsGiver : SamsaraPowerupGiver
{
    Powerup.Type "SamsaraSpeedBoots"
    Powerup.Color "Orange", 0.1
}

actor PowerSamsaraSpeedBoots : PowerSpeed { Inventory.Icon "" }

actor SamsaraSpeedBootsPickupInventory : CustomInventory
{
    Inventory.UseSound ""
    Inventory.Icon "ARTIHST1"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.ForbiddenTo "CorvusPlayer", "HexenPlayer"
    Tag "Haste"
    +INVBAR
    +UNDROPPABLE
    States
    {
      Use:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UseHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UseHexen1")
        TNT1 A 0 A_Jump(256,"UseDefault") // for inheriting actors
        goto UseDefault

      UseDefault:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 7, 0), "UseFail")
        goto UsePlaySound

      UseHeretic:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 7, 1), "UseFail")
        goto UsePlaySound

      UseHexen1:
        goto UseHeretic

      UsePlaySound:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UsePlaySoundHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UsePlaySoundHexen1")
        TNT1 A 0 A_Jump(256,"UsePlaySoundDefault") // for inheriting actors
        goto UsePlaySoundDefault

      UsePlaySoundDefault:
        TNT1 A 0 A_PlaySound("samsaraitemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHeretic:
        TNT1 A 0 A_PlaySound("heretic/itemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHexen1:
        TNT1 A 0 A_PlaySound("hexen/artiuse",CHAN_ITEM)
        goto UseSuccess

      UseSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UseSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UseSuccessHexen1")
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"UseSuccessDeusEx")
        TNT1 A 0 A_Jump(256,"UseSuccessDefault") // for inheriting actors
        goto UseSuccessDefault

      UseSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerSpeedBootsGiver")
        goto UseFinish

      UseSuccessHeretic:
        TNT1 A 0 A_GiveInventory("SamsaraPowerSpeedBootsGiverRaven")
        goto UseFinish

      UseSuccessHexen1:
        goto UseSuccessHeretic

      UseSuccessDeusEx:
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",0,"UseSuccessDeusExMaster")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",3,"UseSuccessDeusExAdvanced")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",2,"UseSuccessDeusExProficient")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",1,"UseSuccessDeusExTrained")
      UseSuccessDeusExUntrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerSpeedBootsGiverDeusEx1")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExTrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerSpeedBootsGiverDeusEx2")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExProficient:
        TNT1 A 0 A_GiveInventory("SamsaraPowerSpeedBootsGiverDeusEx3")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExAdvanced:
        TNT1 A 0 A_GiveInventory("SamsaraPowerSpeedBootsGiverDeusEx4")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExMaster:
        TNT1 A 0 A_GiveInventory("SamsaraPowerSpeedBootsGiverDeusEx5")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExFinish:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 200)
        goto UseFinish

      UseFinish:
        TNT1 A 0 A_RailWait
        stop

      UseFail:
        TNT1 A 0
        fail
    }
}

actor SamsaraSpeedBootsPickupInventoryRaven : SamsaraSpeedBootsPickupInventory
{
    Inventory.Icon "ARTISPD"
    Inventory.RestrictedTo "CorvusPlayer", "HexenPlayer"
    Tag "Boots of Speed"
}

actor SamsaraPowerSpeedBootsGiverRaven : SamsaraPowerupGiver { Powerup.Type "SamsaraSpeedBootsRaven" }

actor PowerSamsaraSpeedBootsRaven : PowerSpeed { Inventory.Icon "HXSPD0" }

actor SamsaraPowerSpeedBootsGiverDeusEx1 : SamsaraPowerSpeedBootsGiver {}
actor SamsaraPowerSpeedBootsGiverDeusEx2 : SamsaraPowerSpeedBootsGiver { Powerup.Duration -56 }
actor SamsaraPowerSpeedBootsGiverDeusEx3 : SamsaraPowerSpeedBootsGiver { Powerup.Duration -68 }
actor SamsaraPowerSpeedBootsGiverDeusEx4 : SamsaraPowerSpeedBootsGiver { Powerup.Duration -79 }
actor SamsaraPowerSpeedBootsGiverDeusEx5 : SamsaraPowerSpeedBootsGiver { Powerup.Duration -90 }

// Banishment
actor SamsaraTeleportOtherPickup : SamsaraPowerupPickup
{
    Inventory.PickupFlash "PickupFlash"
    RenderStyle "Normal"
    //Alpha 0.95
    Scale 0.5
    States
    {
      Spawn:
        CPRT G 0 Bright Light("SAMSARA_BANISHMENT") NoDelay ACS_NamedExecuteWithResult("Samsara_SwitchableObject", 27)
      SpawnDropCheck:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 1, 1), 1)
        goto SpawnGameModeCheck
        TNT1 A 0 A_ChangeFlag("COUNTITEM",false)
        goto SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        CPRT G -1 Bright Light("SAMSARA_BANISHMENT") A_ChangeFlag("NOTIMEFREEZE",false)
        stop

      Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupHexen1")
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        TNT1 A 0 A_JumpIfInventory("SamsaraTeleportOtherPickupInventory",0,"PickupFail")
        goto PickupDisplay

      PickupHeretic:
        TNT1 A 0 A_JumpIfInventory("SamsaraTeleportOtherPickupInventoryRaven",0,"PickupFail")
        goto PickupDisplay

      PickupHexen1:
        goto PickupHeretic

      PickupDisplay:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupDisplayHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupDisplayHexen1")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupDisplayMarathon")
        TNT1 A 0 A_Jump(256,"PickupDisplayDefault") // for inheriting actors
        goto PickupDisplayDefault

      PickupDisplayDefault:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 20, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("teleportotherpickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayHeretic:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 20, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayHexen1:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 20, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("hexen/artiget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayMarathon:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 20, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("marathon/bigitemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupSuccessHexen1")
        TNT1 A 0 A_Jump(256,"PickupSuccessDefault") // for inheriting actors
        goto PickupSuccessDefault

      PickupSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraTeleportOtherPickupInventory")
        stop

      PickupSuccessHeretic:
        TNT1 A 0 A_GiveInventory("SamsaraTeleportOtherPickupInventoryRaven")
        stop

      PickupSuccessHexen1:
        goto PickupSuccessHeretic
    }
}

actor SamsaraHexenTeleportOtherPickup : SamsaraTeleportOtherPickup replaces ArtiTeleportOther { +COUNTITEM }

actor SamsaraTeleportOtherPickupInventory : CustomInventory
{
    Inventory.UseSound ""
    Inventory.Icon "ARTIBAN1"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.ForbiddenTo "CorvusPlayer", "HexenPlayer"
    Tag "Banishment"
    +INVBAR
    +UNDROPPABLE
    States
    {
      Use:
        TNT1 A 0 A_Jump(256,"UseDefault") // for inheriting actors
        goto UseDefault

      UseDefault:
        goto UsePlaySound

      UsePlaySound:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UsePlaySoundHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UsePlaySoundHexen1")
        TNT1 A 0 A_Jump(256,"UsePlaySoundDefault") // for inheriting actors
        goto UsePlaySoundDefault

      UsePlaySoundDefault:
        TNT1 A 0 A_PlaySound("samsaraitemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHeretic:
        TNT1 A 0 A_PlaySound("heretic/itemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHexen1:
        TNT1 A 0 A_PlaySound("hexen/artiuse",CHAN_ITEM)
        goto UseSuccess

      UseSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UseSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UseSuccessHexen1")
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"UseSuccessDeusEx")
        TNT1 A 0 A_Jump(256,"UseSuccessDefault") // for inheriting actors
        goto UseSuccessDefault

      UseSuccessDefault:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"UseSuccessDefaultCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"UseSuccessDefaultCoop")
      UseSuccessDefaultDM:
        TNT1 A 0 A_FireCustomMissile("SamsaraTeleportOtherFX1",0,false)
        goto UseFinish

      UseSuccessDefaultCoop:
        TNT1 A 0 A_FireCustomMissile("SamsaraTeleportOtherFX1Coop",0,false)
        goto UseFinish

      UseSuccessHeretic:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"UseSuccessHereticCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"UseSuccessHereticCoop")
      UseSuccessHereticDM:
        TNT1 A 0 A_FireCustomMissile("SamsaraTeleportOtherFX1Raven",0,false)
        goto UseFinish

      UseSuccessHereticCoop:
        TNT1 A 0 A_FireCustomMissile("SamsaraTeleportOtherFX1RavenCoop",0,false)
        goto UseFinish

      UseSuccessHexen1:
        goto UseSuccessHeretic

      UseSuccessDeusEx:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"UseSuccessDeusExCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"UseSuccessDeusExCoop")
      UseSuccessDeusExDM:
        TNT1 A 0 A_FireCustomMissile("SamsaraTeleportOtherFX1",0,false)
        goto UseSuccessDeusExFinish

      UseSuccessDeusExCoop:
        TNT1 A 0 A_FireCustomMissile("SamsaraTeleportOtherFX1Coop",0,false)
        goto UseSuccessDeusExFinish

      UseSuccessDeusExFinish:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 150)
        goto UseFinish

      UseFinish:
        TNT1 A 0 A_RailWait
        stop

      UseFail:
        TNT1 A 0
        fail
    }
}

actor SamsaraTeleportOtherPickupInventoryRaven : SamsaraTeleportOtherPickupInventory
{
    Inventory.Icon "ARTIBAN2"
    Inventory.RestrictedTo "CorvusPlayer", "HexenPlayer"
    Tag "Banishment Device"
}

actor SamsaraTeleportOtherFXCounter : Counter { Inventory.MaxAmount 2 }

actor SamsaraTeleportOtherFX1 : TelOtherFX1
{
    States
    {
      Spawn:
        TRNG J 5 Bright Light("SAMSARA_BANISHMENTFX")
        TRNG I 4 Bright Light("SAMSARA_BANISHMENTFX")
      SpawnLoop: // Spawn+2
        TRNG H 3 Bright Light("SAMSARA_BANISHMENTFX") A_SpawnItemEx("SamsaraTeleportOtherFX4",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG G 3 Bright Light("SAMSARA_BANISHMENTFX") A_SpawnItemEx("SamsaraTeleportOtherFX3",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG F 3 Bright Light("SAMSARA_BANISHMENTFX") A_SpawnItemEx("SamsaraTeleportOtherFX2",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG G 3 Bright Light("SAMSARA_BANISHMENTFX") A_SpawnItemEx("SamsaraTeleportOtherFX3",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG H 3 Bright Light("SAMSARA_BANISHMENTFX") A_SpawnItemEx("SamsaraTeleportOtherFX4",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG I 3 Bright Light("SAMSARA_BANISHMENTFX") A_SpawnItemEx("SamsaraTeleportOtherFX5",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        loop

      Death:
        TRNG J 3 Bright Light("SAMSARA_BANISHMENTFX")
        stop
    }
}

actor SamsaraTeleportOtherFX2 : SamsaraTeleportOtherFX1
{
    Speed 16
    States
    {
      Spawn:
        TRNG GHIHG 4 Bright Light("SAMSARA_BANISHMENTFX")
        TNT1 A 0 A_GiveInventory("SamsaraTeleportOtherFXCounter")
        TRNG F 4 Bright Light("SAMSARA_BANISHMENTFX") A_JumpIfInventory("SamsaraTeleportOtherFXCounter",0,"Death")
        loop
    }
}

actor SamsaraTeleportOtherFX3 : SamsaraTeleportOtherFX1
{
    Speed 16
    States
    {
      Spawn:
        TRNG HIHGF 4 Bright Light("SAMSARA_BANISHMENTFX")
        TNT1 A 0 A_GiveInventory("SamsaraTeleportOtherFXCounter")
        TRNG G 4 Bright Light("SAMSARA_BANISHMENTFX") A_JumpIfInventory("SamsaraTeleportOtherFXCounter",0,"Death")
        loop
    }
}

actor SamsaraTeleportOtherFX4 : SamsaraTeleportOtherFX1
{
    Speed 16
    States
    {
      Spawn:
        TRNG IHGFG 4 Bright Light("SAMSARA_BANISHMENTFX")
        TNT1 A 0 A_GiveInventory("SamsaraTeleportOtherFXCounter")
        TRNG H 4 Bright Light("SAMSARA_BANISHMENTFX") A_JumpIfInventory("SamsaraTeleportOtherFXCounter",0,"Death")
        loop
    }
}

actor SamsaraTeleportOtherFX5 : SamsaraTeleportOtherFX1
{
    Speed 16
    States
    {
      Spawn:
        TRNG HGFGH 4 Bright Light("SAMSARA_BANISHMENTFX")
        TNT1 A 0 A_GiveInventory("SamsaraTeleportOtherFXCounter")
        TRNG I 4 Bright Light("SAMSARA_BANISHMENTFX") A_JumpIfInventory("SamsaraTeleportOtherFXCounter",0,"Death")
        loop
    }
}

actor SamsaraTeleportOtherFX1Coop : SamsaraTeleportOtherFX1
{
    Species "Player"
    +THRUSPECIES
    States
    {
      Spawn:
        TRNG J 5 Bright Light("SAMSARA_BANISHMENTFX")
        TRNG I 4 Bright Light("SAMSARA_BANISHMENTFX")
      SpawnLoop: // Spawn+2
        TRNG H 3 Bright Light("SAMSARA_BANISHMENTFX") A_SpawnItemEx("SamsaraTeleportOtherFX4Coop",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG G 3 Bright Light("SAMSARA_BANISHMENTFX") A_SpawnItemEx("SamsaraTeleportOtherFX3Coop",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG F 3 Bright Light("SAMSARA_BANISHMENTFX") A_SpawnItemEx("SamsaraTeleportOtherFX2Coop",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG G 3 Bright Light("SAMSARA_BANISHMENTFX") A_SpawnItemEx("SamsaraTeleportOtherFX3Coop",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG H 3 Bright Light("SAMSARA_BANISHMENTFX") A_SpawnItemEx("SamsaraTeleportOtherFX4Coop",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG I 3 Bright Light("SAMSARA_BANISHMENTFX") A_SpawnItemEx("SamsaraTeleportOtherFX5Coop",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        loop
    }
}

actor SamsaraTeleportOtherFX2Coop : SamsaraTeleportOtherFX2
{
    Species "Player"
    +THRUSPECIES
}

actor SamsaraTeleportOtherFX3Coop : SamsaraTeleportOtherFX3
{
    Species "Player"
    +THRUSPECIES
}

actor SamsaraTeleportOtherFX4Coop : SamsaraTeleportOtherFX4
{
    Species "Player"
    +THRUSPECIES
}

actor SamsaraTeleportOtherFX5Coop : SamsaraTeleportOtherFX5
{
    Species "Player"
    +THRUSPECIES
}

actor SamsaraTeleportOtherFX1Raven : TelOtherFX1
{
    States
    {
      Spawn:
        TRNG E 5 Bright
        TRNG D 4 Bright
      SpawnLoop: // Spawn+2
        TRNG C 3 Bright A_SpawnItemEx("SamsaraTeleportOtherFX4Raven",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG B 3 Bright A_SpawnItemEx("SamsaraTeleportOtherFX3Raven",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG A 3 Bright A_SpawnItemEx("SamsaraTeleportOtherFX2Raven",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG B 3 Bright A_SpawnItemEx("SamsaraTeleportOtherFX3Raven",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG C 3 Bright A_SpawnItemEx("SamsaraTeleportOtherFX4Raven",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG D 3 Bright A_SpawnItemEx("SamsaraTeleportOtherFX5Raven",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        loop

      Death:
        TRNG E 3 Bright
        stop
    }
}

actor SamsaraTeleportOtherFX2Raven : SamsaraTeleportOtherFX1Raven
{
    Speed 16
    States
    {
      Spawn:
        TRNG BCDCB 4 Bright
        TNT1 A 0 A_GiveInventory("SamsaraTeleportOtherFXCounter")
        TRNG A 4 Bright A_JumpIfInventory("SamsaraTeleportOtherFXCounter",0,"Death")
        loop
    }
}

actor SamsaraTeleportOtherFX3Raven : SamsaraTeleportOtherFX1Raven
{
    Speed 16
    States
    {
      Spawn:
        TRNG CDCBA 4 Bright
        TNT1 A 0 A_GiveInventory("SamsaraTeleportOtherFXCounter")
        TRNG B 4 Bright A_JumpIfInventory("SamsaraTeleportOtherFXCounter",0,"Death")
        loop
    }
}

actor SamsaraTeleportOtherFX4Raven : SamsaraTeleportOtherFX1Raven
{
    Speed 16
    States
    {
      Spawn:
        TRNG DCBAB 4 Bright
        TNT1 A 0 A_GiveInventory("SamsaraTeleportOtherFXCounter")
        TRNG C 4 Bright A_JumpIfInventory("SamsaraTeleportOtherFXCounter",0,"Death")
        loop
    }
}

actor SamsaraTeleportOtherFX5Raven : SamsaraTeleportOtherFX1Raven
{
    Speed 16
    States
    {
      Spawn:
        TRNG CBABC 4 Bright
        TNT1 A 0 A_GiveInventory("SamsaraTeleportOtherFXCounter")
        TRNG D 4 Bright A_JumpIfInventory("SamsaraTeleportOtherFXCounter",0,"Death")
        loop
    }
}

actor SamsaraTeleportOtherFX1RavenCoop : SamsaraTeleportOtherFX1Raven
{
    Species "Player"
    +THRUSPECIES
    States
    {
      Spawn:
        TRNG E 5 Bright
        TRNG D 4 Bright
      SpawnLoop: // Spawn+2
        TRNG C 3 Bright A_SpawnItemEx("SamsaraTeleportOtherFX4RavenCoop",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG B 3 Bright A_SpawnItemEx("SamsaraTeleportOtherFX3RavenCoop",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG A 3 Bright A_SpawnItemEx("SamsaraTeleportOtherFX2RavenCoop",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG B 3 Bright A_SpawnItemEx("SamsaraTeleportOtherFX3RavenCoop",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG C 3 Bright A_SpawnItemEx("SamsaraTeleportOtherFX4RavenCoop",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG D 3 Bright A_SpawnItemEx("SamsaraTeleportOtherFX5RavenCoop",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        loop
    }
}

actor SamsaraTeleportOtherFX2RavenCoop : SamsaraTeleportOtherFX2Raven
{
    Species "Player"
    +THRUSPECIES
}

actor SamsaraTeleportOtherFX3RavenCoop : SamsaraTeleportOtherFX3Raven
{
    Species "Player"
    +THRUSPECIES
}

actor SamsaraTeleportOtherFX4RavenCoop : SamsaraTeleportOtherFX4Raven
{
    Species "Player"
    +THRUSPECIES
}

actor SamsaraTeleportOtherFX5RavenCoop : SamsaraTeleportOtherFX5Raven
{
    Species "Player"
    +THRUSPECIES
}

// Skulltag Powerups

// Full Invisibility
actor InvisibilitySphere : BlurSphere 5035 // skulltag compatibility
{
    Game Doom
    Game Raven
    SpawnID 174
}

actor SamsaraFullInvisibility : SamsaraPowerupPickup
{
    Inventory.PickupFlash "PickupFlash"
    RenderStyle "Normal"
    //Alpha 0.95
    Scale 0.5
    States
    {
      Spawn:
        CPRT L 0 Bright Light("SAMSARA_FULLINVISIBILITY") NoDelay ACS_NamedExecuteWithResult("Samsara_SwitchableObject", 28)
      SpawnDropCheck:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 1, 1), 1)
        goto SpawnGameModeCheck
        TNT1 A 0 A_ChangeFlag("COUNTITEM",false)
        goto SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        CPRT L -1 Bright Light("SAMSARA_FULLINVISIBILITY") A_ChangeFlag("NOTIMEFREEZE",false)
        stop

      Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupHeretic")
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        goto PickupDisplay

      PickupHeretic:
        TNT1 A 0 A_JumpIfInventory("SamsaraFullInvisibilityInventoryHeretic",0,"PickupFail")
        goto PickupDisplay

      PickupDisplay:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupDisplayHeretic")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupDisplayMarathon")
        TNT1 A 0 A_JumpIfInventory("QuakeClass",1,"PickupDisplayQuake1")
        TNT1 A 0 A_JumpIfInventory("Q3Class",1,"PickupDisplayQuake3")
        TNT1 A 0 A_Jump(256,"PickupDisplayDefault") // for inheriting actors
        goto PickupDisplayDefault

      PickupDisplayDefault:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 9, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("fullinvisibilityget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 4)
        goto PickupSuccess

      PickupDisplayHeretic:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 9, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 4)
        goto PickupSuccess

      PickupDisplayMarathon:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 9, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("marathon/bigitemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 4)
        goto PickupSuccess

      PickupDisplayQuake1:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 3)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraDecorate", 0, 25) //A_PlaySound("quake/invisannouncer",CHAN_7,1.0,false,ATTN_NONE)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 4)
        goto PickupSuccess

      PickupDisplayQuake3:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 11)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 ACS_NamedExecuteAlways("Q3_Announcer", 0, 0) //A_PlaySound("Quake3/Items/Invisibility",CHAN_6)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 4)
        goto PickupSuccess

      PickupSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupSuccessHexen1")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupSuccessMarathon")
        TNT1 A 0 A_JumpIfInventory("QuakeClass",1,"PickupSuccessQuake1")
        TNT1 A 0 A_JumpIfInventory("RTCWClass",1,"PickupSuccessRTCW")
        TNT1 A 0 A_JumpIfInventory("Q3Class",1,"PickupSuccessQuake3")
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"PickupSuccessDeusEx")
        TNT1 A 0 A_Jump(256,"PickupSuccessDefault") // for inheriting actors
        goto PickupSuccessDefault

      PickupSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFullInvisibilityGiver")
        stop

      PickupSuccessHeretic:
        TNT1 A 0 A_GiveInventory("SamsaraFullInvisibilityInventoryHeretic")
        stop

      PickupSuccessHexen1:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFullInvisibilityGhostGiver")
        stop

      PickupSuccessMarathon:
        TNT1 AA 0 A_GiveInventory("SamsaraPowerFullInvisibilityShadowGiver")
        TNT1 A 0 A_GiveInventory("SamsaraPowerFullInvisibilityShadowCumulativeLockGiver")
        stop

      PickupSuccessQuake1:
        TNT1 A 0 A_GiveInventory("QuakeInvisTimer",1050)
        stop

      PickupSuccessRTCW:
        TNT1 A 0 A_TakeInventory("RTCW_Detection")
        goto PickupSuccessDefault

      PickupSuccessQuake3:
        TNT1 A 0 A_GiveInventory("Q3InvisibilityCloak")
        stop

      PickupSuccessDeusEx:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 23)
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",0,"PickupSuccessDeusExMaster")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",3,"PickupSuccessDeusExAdvanced")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",2,"PickupSuccessDeusExProficient")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",1,"PickupSuccessDeusExTrained")
      PickupSuccessDeusExUntrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFullInvisibilityGiverDeusEx1")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExTrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFullInvisibilityGiverDeusEx2")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExProficient:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFullInvisibilityGiverDeusEx3")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExAdvanced:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFullInvisibilityGiverDeusEx4")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExMaster:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFullInvisibilityGiverDeusEx5")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExFinish:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 150)
        stop
    }
}

actor SamsaraSkulltagFullInvisibility : SamsaraFullInvisibility replaces InvisibilitySphere
{
    +COUNTITEM
    +NOGRAVITY
}

actor SamsaraPowerFullInvisibilityGiver : SamsaraPowerupGiver { Powerup.Type "SamsaraFullInvisibility" }

actor PowerSamsaraFullInvisibility : PowerInvisibility
{
    Powerup.Mode "Translucent"
    Powerup.Strength 90
    Powerup.Duration -45
}

actor SamsaraPowerFullInvisibilityGhostGiver : SamsaraPowerupGiver { Powerup.Type "SamsaraFullInvisibilityGhost" }

actor PowerSamsaraFullInvisibilityGhost : PowerGhost
{
    Powerup.Strength 68
    Powerup.Duration -45
}

actor SamsaraPowerFullInvisibilityShadowGiver : SamsaraPowerupGiver { Powerup.Type "SamsaraFullInvisibilityShadow" }

actor PowerSamsaraFullInvisibilityShadow : PowerShadow
{
    Powerup.Strength 84
    Powerup.Duration -40
}

actor SamsaraPowerFullInvisibilityShadowCumulativeLockGiver : SamsaraPowerupGiver { Powerup.Type "SamsaraFullInvisibilityShadowCumulativeLock" }

actor PowerSamsaraFullInvisibilityShadowCumulativeLock : PowerShadowCumulativeLock { Powerup.Duration -40 }

actor SamsaraFullInvisibilityInventory : CustomInventory
{
    Inventory.UseSound ""
    +INVBAR
    +UNDROPPABLE
    States
    {
      Use:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UseHeretic")
        TNT1 A 0 A_Jump(256,"UseDefault") // for inheriting actors
        goto UseDefault

      UseDefault:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 8, 0), "UseFail")
        goto UsePlaySound

      UseHeretic:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 8, 1), "UseFail")
        goto UsePlaySound

      UsePlaySound:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UsePlaySoundHeretic")
        TNT1 A 0 A_Jump(256,"UsePlaySoundDefault") // for inheriting actors
        goto UsePlaySoundDefault

      UsePlaySoundDefault:
        goto UseSuccess

      UsePlaySoundHeretic:
        TNT1 A 0 A_PlaySound("heretic/itemuse",CHAN_ITEM)
        goto UseSuccess

      UseSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UseSuccessHeretic")
        TNT1 A 0 A_Jump(256,"UseSuccessDefault") // for inheriting actors
        goto UseSuccessDefault

      UseSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFullInvisibilityGiver")
        goto UseFinish

      UseSuccessHeretic:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFullInvisibilityGhostGiver")
        goto UseFinish

      UseFinish:
        TNT1 A 0 A_RailWait
        stop

      UseFail:
        TNT1 A 0
        fail
    }
}

actor SamsaraFullInvisibilityInventoryHeretic : SamsaraFullInvisibilityInventory
{
    Inventory.Icon "ARTIIVRG"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.RestrictedTo "CorvusPlayer"
    Tag "Ring of Obscurity"
}

actor SamsaraPowerFullInvisibilityGiverDeusEx1 : SamsaraPowerFullInvisibilityGiver {}
actor SamsaraPowerFullInvisibilityGiverDeusEx2 : SamsaraPowerFullInvisibilityGiver { Powerup.Duration -56 }
actor SamsaraPowerFullInvisibilityGiverDeusEx3 : SamsaraPowerFullInvisibilityGiver { Powerup.Duration -68 }
actor SamsaraPowerFullInvisibilityGiverDeusEx4 : SamsaraPowerFullInvisibilityGiver { Powerup.Duration -79 }
actor SamsaraPowerFullInvisibilityGiverDeusEx5 : SamsaraPowerFullInvisibilityGiver { Powerup.Duration -90 }

// Time Freeze
actor TimeFreezeSphere : Powerup 5032 // skulltag compatibility
{
    Game Doom
    Game Raven
    SpawnID 171
    Powerup.Duration -12
}

actor SamsaraTimeFreeze : SamsaraPowerupPickup
{
    Inventory.PickupFlash "PickupFlash"
    RenderStyle "Normal"
    //Alpha 0.95
    Scale 0.5
    States
    {
      Spawn:
        CPRT M 0 Bright Light("SAMSARA_TIMEFREEZE") NoDelay ACS_NamedExecuteWithResult("Samsara_SwitchableObject", 29)
      SpawnDropCheck:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 1, 1), 1)
        goto SpawnGameModeCheck
        TNT1 A 0 A_ChangeFlag("COUNTITEM",false)
        goto SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        CPRT M -1 Bright Light("SAMSARA_TIMEFREEZE") A_ChangeFlag("NOTIMEFREEZE",false)
        stop

      Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupHeretic")
        TNT1 A 0 A_JumpIfInventory("CatacombClass",1,"PickupCatacomb")
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        goto PickupDisplay

      PickupHeretic:
        TNT1 A 0 A_JumpIfInventory("SamsaraTimeFreezeInventoryHeretic",0,"PickupFail")
        goto PickupDisplay

      PickupCatacomb:
        TNT1 A 0 A_JumpIfInventory("Catacomb_Hourglass",1,1)
        goto PickupDisplay
        TNT1 A 0 A_JumpIfInventory("Catacomb_HourglassCooldown",1,"PickupDisplay")
        goto PickupFail

      PickupDisplay:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupDisplayHeretic")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupDisplayMarathon")
        TNT1 A 0 A_JumpIfInventory("CatacombClass",1,"PickupDisplayCatacomb")
        TNT1 A 0 A_Jump(256,"PickupDisplayDefault") // for inheriting actors
        goto PickupDisplayDefault

      PickupDisplayDefault:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 10, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("timefreezeget",CHAN_ITEM|CHAN_MAYBE_LOCAL|CHAN_NOPAUSE)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 5)
        goto PickupSuccess

      PickupDisplayHeretic:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 10, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 5)
        goto PickupSuccess

      PickupDisplayMarathon:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 10, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("marathon/bigitemget",CHAN_ITEM|CHAN_MAYBE_LOCAL|CHAN_NOPAUSE)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 5)
        goto PickupSuccess

      PickupDisplayCatacomb:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 10, 2)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("Catacomb/Hourglass",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 5)
        goto PickupSuccess

      PickupSuccess:
        TNT1 A 0 A_JumpIfInventory("DoomguyClass",1,"PickupSuccessDoom")
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("CatacombClass",1,"PickupSuccessCatacomb")
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"PickupSuccessDeusEx")
        TNT1 A 0 A_Jump(256,"PickupSuccessDefault") // for inheriting actors
        goto PickupSuccessDefault

      PickupSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerTimeFreezerGiver")
        stop

      PickupSuccessDoom:
        TNT1 A 0 A_JumpIfInventory("DoomClassMode",2,"PickupSuccessStronghold")
        goto PickupSuccessDefault

      PickupSuccessStronghold:
        TNT1 A 0 A_GiveInventory("SamsaraPowerTimeFreezerGiverStronghold")
        stop

      PickupSuccessHeretic:
        TNT1 A 0 A_GiveInventory("SamsaraTimeFreezeInventoryHeretic")
        stop

      PickupSuccessCatacomb:
        TNT1 A 0 A_GiveInventory("Catacomb_Hourglass")
        TNT1 A 0 A_JumpIfInventory("Catacomb_HourglassCooldown",1,1)
        stop
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraCatacombHourglassCooldownDecrement")
        stop

      PickupSuccessDeusEx:
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",0,"PickupSuccessDeusExMaster")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",3,"PickupSuccessDeusExAdvanced")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",2,"PickupSuccessDeusExProficient")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",1,"PickupSuccessDeusExTrained")
      PickupSuccessDeusExUntrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerTimeFreezerGiverDeusEx1")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExTrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerTimeFreezerGiverDeusEx2")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExProficient:
        TNT1 A 0 A_GiveInventory("SamsaraPowerTimeFreezerGiverDeusEx3")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExAdvanced:
        TNT1 A 0 A_GiveInventory("SamsaraPowerTimeFreezerGiverDeusEx4")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExMaster:
        TNT1 A 0 A_GiveInventory("SamsaraPowerTimeFreezerGiverDeusEx5")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExFinish:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 200)
        stop
    }
}

actor SamsaraSkulltagTimeFreeze : SamsaraTimeFreeze replaces TimeFreezeSphere
{
    +COUNTITEM
    +NOGRAVITY
}

actor SamsaraPowerTimeFreezerGiver : SamsaraPowerupGiver
{
    Powerup.Type "TimeFreezer"
    Powerup.Color "GoldMap"
}

actor SamsaraTimeFreezeInventory : CustomInventory
{
    Inventory.UseSound ""
    +INVBAR
    +UNDROPPABLE
    States
    {
      Use:
        TNT1 A 0 A_Jump(256,"UseDefault") // for inheriting actors
        goto UseDefault

      UseDefault:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 9, 0), "UseFail")
        goto UsePlaySound

      UsePlaySound:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UsePlaySoundHeretic")
        TNT1 A 0 A_Jump(256,"UsePlaySoundDefault") // for inheriting actors
        goto UsePlaySoundDefault

      UsePlaySoundDefault:
        goto UseSuccess

      UsePlaySoundHeretic:
        TNT1 A 0 A_PlaySound("heretic/itemuse",CHAN_ITEM)
        goto UseSuccess

      UseSuccess:
        TNT1 A 0 A_Jump(256,"UseSuccessDefault") // for inheriting actors
        goto UseSuccessDefault

      UseSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerTimeFreezerGiver")
        goto UseFinish

      UseFinish:
        TNT1 A 0 A_RailWait
        stop

      UseFail:
        TNT1 A 0
        fail
    }
}

actor SamsaraPowerTimeFreezerGiverStronghold : SamsaraPowerTimeFreezerGiver { Powerup.Color "00 33 FF", 0.1 }

actor SamsaraTimeFreezeInventoryHeretic : SamsaraTimeFreezeInventory
{
    Inventory.Icon "ARTITPAM"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.RestrictedTo "CorvusPlayer"
    Tag "Temporal Amulet"
}

actor SamsaraPowerTimeFreezerGiverDeusEx1 : SamsaraPowerTimeFreezerGiver {}
actor SamsaraPowerTimeFreezerGiverDeusEx2 : SamsaraPowerTimeFreezerGiver { Powerup.Duration -15 }
actor SamsaraPowerTimeFreezerGiverDeusEx3 : SamsaraPowerTimeFreezerGiver { Powerup.Duration -18 }
actor SamsaraPowerTimeFreezerGiverDeusEx4 : SamsaraPowerTimeFreezerGiver { Powerup.Duration -21 }
actor SamsaraPowerTimeFreezerGiverDeusEx5 : SamsaraPowerTimeFreezerGiver { Powerup.Duration -24 }

// Speed Booster
actor Turbosphere : Powerup 5030 // skulltag compatibility
{
    Game Doom
    Game Raven
    SpawnID 169
    Powerup.Duration -30
}

actor SamsaraSpeedBooster : SamsaraPowerupPickup
{
    Inventory.PickupFlash "PickupFlash"
    RenderStyle "Normal"
    //Alpha 0.95
    Scale 0.5
    States
    {
      Spawn:
        CPRT O 0 Bright Light("SAMSARA_SPEEDBOOSTER")
      SpawnDropCheck:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 1, 1), 1)
        goto SpawnGameModeCheck
        TNT1 A 0 A_ChangeFlag("COUNTITEM",false)
        goto SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        CPRT O -1 Bright Light("SAMSARA_SPEEDBOOSTER") A_ChangeFlag("NOTIMEFREEZE",false)
        stop

      Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupHexen1")
        TNT1 A 0 A_JumpIfInventory("DukeClass",1,"PickupDuke")
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        goto PickupDisplay

      PickupHeretic:
        TNT1 A 0 A_JumpIfInventory("SamsaraSpeedBootsPickupInventoryRaven",0,"PickupFail")
        goto PickupDisplay

      PickupHexen1:
        goto PickupHeretic

      PickupDuke:
        TNT1 A 0 A_JumpIfInventory("DukePortSteroids",1,3)
        TNT1 A 0 A_JumpIfInventory("DukePortSteroidsLAB",1,2)
        TNT1 A 0 A_JumpIfInventory("DukePortSteroids64",1,1)
        goto PickupDisplay
        TNT1 A 0 A_JumpIfInventory("DukeSteroidsFuel",0,"PickupFail")
        goto PickupDisplay

      PickupDisplay:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupDisplayHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupDisplayHexen1")
        TNT1 A 0 A_JumpIfInventory("DukeClass",1,"PickupDisplayDuke")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupDisplayMarathon")
        TNT1 A 0 A_JumpIfInventory("Q3Class",1,"PickupDisplayQuake3")
        TNT1 A 0 A_Jump(256,"PickupDisplayDefault") // for inheriting actors
        goto PickupDisplayDefault

      PickupDisplayDefault:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 11, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("speedboostget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 6)
        goto PickupSuccess

      PickupDisplayHeretic:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 19, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 6)
        goto PickupSuccess

      PickupDisplayHexen1:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 19, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("hexen/artiget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 6)
        goto PickupSuccess

      PickupDisplayDuke:
        TNT1 A 0 A_JumpIfInventory("DukeClassMode",2,"PickupDisplayDuke64")
        TNT1 A 0 A_JumpIfInventory("DukeClassMode",1,"PickupDisplayDukeLAB")
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 11, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("duke/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 6)
        goto PickupSuccess

      PickupDisplayDukeLAB:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 11, 2)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("duke/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 6)
        goto PickupSuccess

      PickupDisplayDuke64:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 11, 3)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("duke/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 6)
        goto PickupSuccess

      PickupDisplayMarathon:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 11, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("marathon/bigitemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 6)
        goto PickupSuccess

      PickupDisplayQuake3:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 11, 4)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 ACS_NamedExecuteAlways("Q3_Announcer", 0, 3) //A_PlaySound("Quake3/Items/Haste",CHAN_6)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 6)
        goto PickupSuccess

      PickupSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupSuccessHexen1")
        TNT1 A 0 A_JumpIfInventory("DukeClass",1,"PickupSuccessDuke")
        TNT1 A 0 A_JumpIfInventory("Q3Class",1,"PickupSuccessQuake3")
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"PickupSuccessDeusEx")
        TNT1 A 0 A_Jump(256,"PickupSuccessDefault") // for inheriting actors
        goto PickupSuccessDefault

      PickupSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerSpeedBoosterGiver")
        stop

      PickupSuccessHeretic:
        TNT1 A 0 A_GiveInventory("SamsaraSpeedBootsPickupInventoryRaven")
        stop

      PickupSuccessHexen1:
        goto PickupSuccessHeretic

      PickupSuccessDuke:
        TNT1 A 0 A_TakeInventory("DukeSteroidsActive")
        TNT1 A 0 A_TakeInventory("DukeSteroidsSpawnRemove")
        TNT1 A 0 A_TakeInventory("DukeSteroidsSpeed")
        TNT1 A 0 A_TakeInventory("DukeSteroidsDamage")
        TNT1 A 0 A_GiveInventory("DukeSteroidsFuel",100)
        TNT1 A 0 A_JumpIfInventory("DukeClassMode",2,"PickupSuccessDuke64")
        TNT1 A 0 A_JumpIfInventory("DukeClassMode",1,"PickupSuccessDukeLAB")
        TNT1 A 0 A_GiveInventory("DukePortSteroids")
        stop

      PickupSuccessDukeLAB:
        TNT1 A 0 A_GiveInventory("DukePortSteroidsLAB")
        stop

      PickupSuccessDuke64:
        TNT1 A 0 A_GiveInventory("DukePortSteroids64")
        stop

      PickupSuccessQuake3:
        TNT1 A 0 A_GiveInventory("Q3HasteTurbo")
        stop

      PickupSuccessDeusEx:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 23)
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",0,"PickupSuccessDeusExMaster")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",3,"PickupSuccessDeusExAdvanced")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",2,"PickupSuccessDeusExProficient")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",1,"PickupSuccessDeusExTrained")
      PickupSuccessDeusExUntrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerSpeedBoosterGiverDeusEx1")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExTrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerSpeedBoosterGiverDeusEx2")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExProficient:
        TNT1 A 0 A_GiveInventory("SamsaraPowerSpeedBoosterGiverDeusEx3")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExAdvanced:
        TNT1 A 0 A_GiveInventory("SamsaraPowerSpeedBoosterGiverDeusEx4")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExMaster:
        TNT1 A 0 A_GiveInventory("SamsaraPowerSpeedBoosterGiverDeusEx5")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExFinish:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 150)
        stop
    }
}

actor SamsaraSkulltagSpeedBooster : SamsaraSpeedBooster replaces Turbosphere
{
    +COUNTITEM
    +NOGRAVITY
}

actor SamsaraPowerSpeedBoosterGiver : SamsaraPowerupGiver
{
    Powerup.Type "SamsaraSpeedBooster"
    Powerup.Color "Purple", 0.05
}

actor PowerSamsaraSpeedBooster : PowerSpeed
{
    Inventory.Icon ""
    Powerup.Duration -30
}

actor SamsaraPowerSpeedBoosterGiverDeusEx1 : SamsaraPowerSpeedBoosterGiver {}
actor SamsaraPowerSpeedBoosterGiverDeusEx2 : SamsaraPowerSpeedBoosterGiver { Powerup.Duration -37 }
actor SamsaraPowerSpeedBoosterGiverDeusEx3 : SamsaraPowerSpeedBoosterGiver { Powerup.Duration -45 }
actor SamsaraPowerSpeedBoosterGiverDeusEx4 : SamsaraPowerSpeedBoosterGiver { Powerup.Duration -53 }
actor SamsaraPowerSpeedBoosterGiverDeusEx5 : SamsaraPowerSpeedBoosterGiver { Powerup.Duration -60 }

// Defense Booster
actor Guardsphere : Powerup 5037 // skulltag compatibility
{
    Game Doom
    Game Raven
    SpawnID 0
    Powerup.Duration -25
}

actor SamsaraDefenseBooster : SamsaraPowerupPickup
{
    Inventory.PickupFlash "PickupFlash"
    RenderStyle "Normal"
    //Alpha 0.95
    Scale 0.5
    States
    {
      Spawn:
        CPRT P 0 Bright Light("SAMSARA_DEFENSEBOOSTER")
      SpawnDropCheck:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 1, 1), 1)
        goto SpawnGameModeCheck
        TNT1 A 0 A_ChangeFlag("COUNTITEM",false)
        goto SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        CPRT P -1 Bright Light("SAMSARA_DEFENSEBOOSTER") A_ChangeFlag("NOTIMEFREEZE",false)
        stop

      Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupHeretic")
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        goto PickupDisplay

      PickupHeretic:
        TNT1 A 0 A_JumpIfInventory("SamsaraDefenseBoosterInventoryHeretic",0,"PickupFail")
        goto PickupDisplay

      PickupDisplay:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupDisplayHeretic")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupDisplayMarathon")
        TNT1 A 0 A_Jump(256,"PickupDisplayDefault") // for inheriting actors
        goto PickupDisplayDefault

      PickupDisplayDefault:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 12, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("defenseboostget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 7)
        goto PickupSuccess

      PickupDisplayHeretic:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 12, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 7)
        goto PickupSuccess

      PickupDisplayMarathon:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 12, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("marathon/bigitemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 7)
        goto PickupSuccess

      PickupSuccess:
        TNT1 A 0 A_JumpIfInventory("DoomguyClass",1,"PickupSuccessDoom")
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"PickupSuccessDeusEx")
        TNT1 A 0 A_Jump(256,"PickupSuccessDefault") // for inheriting actors
        goto PickupSuccessDefault

      PickupSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerDefenseBoosterGiver")
        stop

      PickupSuccessDoom:
        TNT1 A 0 A_JumpIfInventory("DoomClassMode",2,"PickupSuccessStronghold")
        goto PickupSuccessDefault

      PickupSuccessStronghold:
        TNT1 A 0 A_GiveInventory("SamsaraPowerDefenseBoosterGiverStronghold")
        stop

      PickupSuccessHeretic:
        TNT1 A 0 A_GiveInventory("SamsaraDefenseBoosterInventoryHeretic")
        stop

      PickupSuccessDeusEx:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 23)
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",0,"PickupSuccessDeusExMaster")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",3,"PickupSuccessDeusExAdvanced")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",2,"PickupSuccessDeusExProficient")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",1,"PickupSuccessDeusExTrained")
      PickupSuccessDeusExUntrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerDefenseBoosterGiverDeusEx1")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExTrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerDefenseBoosterGiverDeusEx2")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExProficient:
        TNT1 A 0 A_GiveInventory("SamsaraPowerDefenseBoosterGiverDeusEx3")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExAdvanced:
        TNT1 A 0 A_GiveInventory("SamsaraPowerDefenseBoosterGiverDeusEx4")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExMaster:
        TNT1 A 0 A_GiveInventory("SamsaraPowerDefenseBoosterGiverDeusEx5")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExFinish:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 250)
        stop
    }
}

actor SamsaraSkulltagDefenseBooster : SamsaraDefenseBooster replaces Guardsphere
{
    +COUNTITEM
    +NOGRAVITY
}

actor SamsaraPowerDefenseBoosterGiver : SamsaraPowerupGiver
{
    Powerup.Type "SamsaraDefenseBooster"
    Powerup.Color "GreenMap"
}

actor PowerSamsaraDefenseBooster : PowerProtection
{
    Powerup.Duration -25
    DamageFactor "Normal", 0.25
}

actor SamsaraDefenseBoosterInventory : CustomInventory
{
    Inventory.UseSound ""
    +INVBAR
    +UNDROPPABLE
    States
    {
      Use:
        TNT1 A 0 A_Jump(256,"UseDefault") // for inheriting actors
        goto UseDefault

      UseDefault:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 11, 0), "UseFail")
        goto UsePlaySound

      UsePlaySound:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UsePlaySoundHeretic")
        TNT1 A 0 A_Jump(256,"UsePlaySoundDefault") // for inheriting actors
        goto UsePlaySoundDefault

      UsePlaySoundDefault:
        goto UseSuccess

      UsePlaySoundHeretic:
        TNT1 A 0 A_PlaySound("heretic/itemuse",CHAN_ITEM)
        goto UseSuccess

      UseSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UseSuccessHeretic")
        TNT1 A 0 A_Jump(256,"UseSuccessDefault") // for inheriting actors
        goto UseSuccessDefault

      UseSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerDefenseBoosterGiver")
        goto UseFinish

      UseSuccessHeretic:
        TNT1 A 0 A_GiveInventory("SamsaraPowerDefenseBoosterGiverHeretic")
        goto UseFinish

      UseFinish:
        TNT1 A 0 A_RailWait
        stop

      UseFail:
        TNT1 A 0
        fail
    }
}

actor SamsaraPowerDefenseBoosterGiverStronghold : SamsaraPowerDefenseBoosterGiver { Powerup.Color "FF AA 00", 0.1 }

actor SamsaraDefenseBoosterInventoryHeretic : SamsaraDefenseBoosterInventory
{
    Inventory.Icon "ARTIBRFC"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.RestrictedTo "CorvusPlayer"
    Tag "Bracers of Force"
}

actor SamsaraPowerDefenseBoosterGiverHeretic : SamsaraPowerDefenseBoosterGiver { Powerup.Color "Blue", 0.1 }

actor SamsaraPowerDefenseBoosterGiverDeusEx1 : SamsaraPowerDefenseBoosterGiver {}
actor SamsaraPowerDefenseBoosterGiverDeusEx2 : SamsaraPowerDefenseBoosterGiver { Powerup.Duration -31 }
actor SamsaraPowerDefenseBoosterGiverDeusEx3 : SamsaraPowerDefenseBoosterGiver { Powerup.Duration -38 }
actor SamsaraPowerDefenseBoosterGiverDeusEx4 : SamsaraPowerDefenseBoosterGiver { Powerup.Duration -44 }
actor SamsaraPowerDefenseBoosterGiverDeusEx5 : SamsaraPowerDefenseBoosterGiver { Powerup.Duration -50 }

// Damage Booster
actor Doomsphere : Powerup 5036 // skulltag compatibility
{
    Game Doom
    Game Raven
    SpawnID 175
    Powerup.Duration -25
}

actor SamsaraDamageBooster : SamsaraPowerupPickup
{
    Inventory.PickupFlash "PickupFlash"
    RenderStyle "Normal"
    //Alpha 0.95
    Scale 0.5
    States
    {
      Spawn:
        CPRT N 0 Bright Light("SAMSARA_DAMAGEBOOSTER")
      SpawnDropCheck:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 1, 1), 1)
        goto SpawnGameModeCheck
        TNT1 A 0 A_ChangeFlag("COUNTITEM",false)
        goto SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        CPRT N -1 Bright Light("SAMSARA_DAMAGEBOOSTER") A_ChangeFlag("NOTIMEFREEZE",false)
        stop

      Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupHeretic")
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        goto PickupDisplay

      PickupHeretic:
        TNT1 A 0 A_JumpIfInventory("SamsaraDamageBoosterInventoryHeretic",0,"PickupFail")
        goto PickupDisplay

      PickupDisplay:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupDisplayHeretic")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupDisplayMarathon")
        TNT1 A 0 A_JumpIfInventory("Q3Class",1,"PickupDisplayQuake3")
        TNT1 A 0 A_Jump(256,"PickupDisplayDefault") // for inheriting actors
        goto PickupDisplayDefault

      PickupDisplayDefault:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 13, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("damageboostget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 8)
        goto PickupSuccess

      PickupDisplayHeretic:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 13, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 8)
        goto PickupSuccess

      PickupDisplayMarathon:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 13, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("marathon/bigitemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 8)
        goto PickupSuccess

      PickupDisplayQuake3:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 13, 2)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 ACS_NamedExecuteAlways("Q3_Announcer", 0, 1) //A_PlaySound("Quake3/Items/QuadDamage",CHAN_6)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 8)
        goto PickupSuccess

      PickupSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("Q3Class",1,"PickupSuccessQuake3")
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"PickupSuccessDeusEx")
        TNT1 A 0 A_Jump(256,"PickupSuccessDefault") // for inheriting actors
        goto PickupSuccessDefault

      PickupSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerDamageBoosterGiver")
        stop

      PickupSuccessHeretic:
        TNT1 A 0 A_GiveInventory("SamsaraDamageBoosterInventoryHeretic")
        stop

      PickupSuccessQuake3:
        TNT1 A 0 A_GiveInventory("Q3QuadDamageFactor")
        stop

      PickupSuccessDeusEx:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 23)
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",0,"PickupSuccessDeusExMaster")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",3,"PickupSuccessDeusExAdvanced")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",2,"PickupSuccessDeusExProficient")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",1,"PickupSuccessDeusExTrained")
      PickupSuccessDeusExUntrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerDamageBoosterGiverDeusEx1")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExTrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerDamageBoosterGiverDeusEx2")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExProficient:
        TNT1 A 0 A_GiveInventory("SamsaraPowerDamageBoosterGiverDeusEx3")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExAdvanced:
        TNT1 A 0 A_GiveInventory("SamsaraPowerDamageBoosterGiverDeusEx4")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExMaster:
        TNT1 A 0 A_GiveInventory("SamsaraPowerDamageBoosterGiverDeusEx5")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExFinish:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 250)
        stop
    }
}

actor SamsaraSkulltagDamageBooster : SamsaraDamageBooster replaces Doomsphere
{
    +COUNTITEM
    +NOGRAVITY
}

actor SamsaraPowerDamageBoosterGiver : SamsaraPowerupGiver
{
    Powerup.Type "SamsaraDamageBooster"
    Powerup.Color "RedMap"
}

actor PowerSamsaraDamageBooster : PowerDamage
{
    Powerup.Duration -25
    DamageFactor "Normal", 4
}

actor SamsaraDamageBoosterInventory : CustomInventory
{
    Inventory.UseSound ""
    +INVBAR
    +UNDROPPABLE
    States
    {
      Use:
        TNT1 A 0 A_Jump(256,"UseDefault") // for inheriting actors
        goto UseDefault

      UseDefault:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 12, 0), "UseFail")
        goto UsePlaySound

      UsePlaySound:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UsePlaySoundHeretic")
        TNT1 A 0 A_Jump(256,"UsePlaySoundDefault") // for inheriting actors
        goto UsePlaySoundDefault

      UsePlaySoundDefault:
        goto UseSuccess

      UsePlaySoundHeretic:
        TNT1 A 0 A_PlaySound("heretic/itemuse",CHAN_ITEM)
        goto UseSuccess

      UseSuccess:
        TNT1 A 0 A_Jump(256,"UseSuccessDefault") // for inheriting actors
        goto UseSuccessDefault

      UseSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerDamageBoosterGiver")
        goto UseFinish

      UseFinish:
        TNT1 A 0 A_RailWait
        stop

      UseFail:
        TNT1 A 0
        fail
    }
}

actor SamsaraDamageBoosterInventoryHeretic : SamsaraDamageBoosterInventory
{
    Inventory.Icon "ARTITOM3"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.RestrictedTo "CorvusPlayer"
    Tag "Master's Tome of Strength"
}

actor SamsaraPowerDamageBoosterGiverDeusEx1 : SamsaraPowerDamageBoosterGiver {}
actor SamsaraPowerDamageBoosterGiverDeusEx2 : SamsaraPowerDamageBoosterGiver { Powerup.Duration -31 }
actor SamsaraPowerDamageBoosterGiverDeusEx3 : SamsaraPowerDamageBoosterGiver { Powerup.Duration -38 }
actor SamsaraPowerDamageBoosterGiverDeusEx4 : SamsaraPowerDamageBoosterGiver { Powerup.Duration -44 }
actor SamsaraPowerDamageBoosterGiverDeusEx5 : SamsaraPowerDamageBoosterGiver { Powerup.Duration -50 }

/*
    Zandronum's random powerup item has the player get an item that corresponds to the
    sprite, so if they picked up a random powerup that switched to the Megasphere's
    sprite, then they will get the megasphere. In order to keep things simple internally,
    Samsara has the player get a randomly chosen powerup, even if they picked it up 48 tics later.
    This removes the strategization that can come from waiting for a desired powerup, but it
    makes things way easier to handle for programming, especially with future updates.
*/

actor RandomPowerup : Powerup 5039 // skulltag compatibility
{
    Game Doom
    SpawnID 176
    Powerup.Duration -30
}

actor SamsaraRandomPowerup : SamsaraPowerupPickup
{
    Inventory.PickupFlash "PickupFlash"
    Alpha 0.95
    Scale 0.75
    States
    {
      Spawn:
        STPQ A 0 Bright Light("RANDOMPOWERUP") NoDelay ACS_NamedExecuteWithResult("Samsara_SwitchableObject", 33)
      SpawnDropCheck:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 1, 1), 1)
        goto SpawnGameModeCheck
        TNT1 A 0 A_ChangeFlag("COUNTITEM",false)
        goto SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        TNT1 A 0 A_ChangeFlag("NOTIMEFREEZE",false)
      SpawnActualAnim:
        STPQ A 35 Bright Light("RANDOMPOWERUP") ACS_NamedExecuteAlways("SamsaraClientDecorate", 0, 4, 100, 95)
        loop

      Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupHeretic")
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        goto PickupJump

      PickupHeretic:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 32), 3) // samsara_nohealth
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 22), "PickupJump") // samsara_nohealthcap
        TNT1 A 0 A_JumpIfInventory("CorvusMegasphere",0,1)
        goto PickupJump
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 32), 3) // samsara_nohealth
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 22), "PickupJump") // samsara_nohealthcap
        TNT1 A 0 A_JumpIfInventory("PortSuperHealth",0,1)
        goto PickupJump
        TNT1 A 0 A_JumpIfInventory("SamsaraDefenseBoosterInventoryHeretic",0,1)
        goto PickupJump
        TNT1 A 0 A_JumpIfInventory("PortGhostly",0,1)
        goto PickupJump
        TNT1 A 0 A_JumpIfInventory("SamsaraTimeFreezeInventoryHeretic",0,1)
        goto PickupJump
        TNT1 A 0 A_JumpIfInventory("SamsaraFullInvisibilityInventoryHeretic",0,1)
        goto PickupJump
        TNT1 A 0 A_JumpIfInventory("SamsaraDamageBoosterInventoryHeretic",0,1)
        goto PickupJump
        TNT1 A 0 A_JumpIfInventory("SamsaraSpeedBootsPickupInventoryRaven",0,"PickupFail")
        goto PickupJump

      PickupJump:
        TNT1 A 0 A_Jump(256,"PickupMegasphere","PickupSoulsphere","PickupGuardsphere","PickupBlurSphere","PickupTimeFreezeSphere","PickupInvisibilitySphere","PickupDoomsphere","PickupTurbosphere")
        goto PickupMegasphere

      // Megasphere
      PickupMegasphere:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 32), "PickupJump") // samsara_nohealth
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupMegasphereHeretic")
        TNT1 A 0 A_Jump(256,"PickupMegasphereDefault") // for inheriting actors
        goto PickupMegasphereDefault

      PickupMegasphereDefault:
        goto PickupMegasphereSuccess

      PickupMegasphereHeretic:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 22), "PickupMegasphereSuccess") // samsara_nohealthcap
        TNT1 A 0 A_JumpIfInventory("CorvusMegasphere",0,"PickupJump")
        goto PickupMegasphereSuccess

      PickupMegasphereSuccess:
        TNT1 A 0 A_GiveInventory("MegaPack")
        stop

      // Soulsphere
      PickupSoulsphere:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 32), "PickupJump") // samsara_nohealth
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupSoulsphereHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupSoulsphereHexen1")
        // Caleb always picks it up due to different pickup system
        TNT1 A 0 A_JumpIfInventory("StrifeClass",1,"PickupSoulsphereStrife")
        TNT1 A 0 A_JumpIfInventory("RMRClass",1,"PickupSoulsphereRMR")
        // Leonard always picks it up due to different pickup system
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"PickupSoulsphereHexen2")
        TNT1 A 0 A_JumpIfInventory("CatacombClass",1,"PickupSoulsphereCatacomb")
        TNT1 A 0 A_Jump(256,"PickupSoulsphereDefault") // for inheriting actors
        goto PickupSoulsphereDefault

      PickupSoulsphereDefault:
        goto PickupSoulsphereSuccess

      PickupSoulsphereHeretic:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 22), "PickupSoulsphereSuccess") // samsara_nohealthcap
        TNT1 A 0 A_JumpIfInventory("PortSuperHealth",0,"PickupJump")
        goto PickupSoulsphereSuccess

      PickupSoulsphereHexen1:
        goto PickupSoulsphereHeretic

      PickupSoulsphereStrife:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 22), "PickupSoulsphereSuccess") // samsara_nohealthcap
        TNT1 A 0 A_JumpIfInventory("StrifeSurgeryKit2",0,"PickupJump")
        goto PickupSoulsphereSuccess

      PickupSoulsphereRMR:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 22), "PickupSoulsphereSuccess") // samsara_nohealthcap
        TNT1 A 0 A_JumpIfInventory("RMROxygenRecycler",0,"PickupJump")
        goto PickupSoulsphereSuccess

      PickupSoulsphereHexen2:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 22), "PickupSoulsphereSuccess") // samsara_nohealthcap
        TNT1 A 0 A_JumpIfInventory("PortSuperHealth3",0,"PickupJump")
        goto PickupSoulsphereSuccess

      PickupSoulsphereCatacomb:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 22), "PickupSoulsphereSuccess") // samsara_nohealthcap
        TNT1 A 0 A_JumpIfInventory("Catacomb_LargeHealthPotion",0,"PickupJump")
        goto PickupSoulsphereSuccess

      PickupSoulsphereSuccess:
        TNT1 A 0 A_GiveInventory("SuperHealth")
        stop

      // Defense Booster
      PickupGuardsphere:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupGuardsphereHeretic")
        TNT1 A 0 A_Jump(256,"PickupGuardsphereDefault") // for inheriting actors
        goto PickupGuardsphereDefault

      PickupGuardsphereDefault:
        goto PickupGuardsphereSuccess

      PickupGuardsphereHeretic:
        TNT1 A 0 A_JumpIfInventory("SamsaraDefenseBoosterInventoryHeretic",0,"PickupJump")
        goto PickupGuardsphereSuccess

      PickupGuardsphereSuccess:
        TNT1 A 0 A_GiveInventory("SamsaraDefenseBooster")
        stop

      // Partial Invisibility
      PickupBlurSphere:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupBlurSphereHeretic")
        TNT1 A 0 A_JumpIfInventory("DukeClass",1,"PickupBlurSphereDuke")
        TNT1 A 0 A_JumpIfInventory("StrifeClass",1,"PickupBlurSphereStrife")
        TNT1 A 0 A_JumpIfInventory("WitchavenClass",1,"PickupBlurSphereWitchaven")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"PickupBlurSpherePowerSlave")
        TNT1 A 0 A_JumpIfInventory("BittermanClass",1,"PickupBlurSphereQuake2")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"PickupBlurSphereHexen2")
        TNT1 A 0 A_Jump(256,"PickupBlurSphereDefault") // for inheriting actors
        goto PickupBlurSphereDefault

      PickupBlurSphereDefault:
        goto PickupBlurSphereSuccess

      PickupBlurSphereHeretic:
        TNT1 A 0 A_JumpIfInventory("PortGhostly",0,"PickupJump")
        goto PickupBlurSphereSuccess

      PickupBlurSphereDuke:
        TNT1 A 0 A_JumpIfInventory("ItemHoloduke",0,"PickupJump")
        goto PickupBlurSphereSuccess

      PickupBlurSphereStrife:
        TNT1 A 0 A_JumpIfInventory("PortShadowArmor",0,"PickupJump")
        goto PickupBlurSphereSuccess

      PickupBlurSphereWitchaven:
        TNT1 A 0 A_JumpIfInventory("WTInvisibilityPhial",0,"PickupJump")
        goto PickupBlurSphereSuccess

      PickupBlurSpherePowerSlave:
        TNT1 A 0 A_JumpIfInventory("EyeOfSiaItem_EX",0,"PickupJump")
        goto PickupBlurSphereSuccess

      PickupBlurSphereQuake2:
        TNT1 A 0 A_JumpIfInventory("Q2Silencer",0,1)
        goto PickupBlurSphereSuccess
        TNT1 A 0 A_JumpIfInventory("Q2DualFireDamage",0,"PickupJump")
        goto PickupBlurSphereSuccess

      PickupBlurSphereHexen2:
        TNT1 A 0 A_JumpIfInventory("PortGhostly2",0,"PickupJump")
        goto PickupBlurSphereSuccess

      PickupBlurSphereSuccess:
        TNT1 A 0 A_GiveInventory("PartialInvisibility")
        stop

      // Time Freeze
      PickupTimeFreezeSphere:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupTimeFreezeSphereHeretic")
        TNT1 A 0 A_JumpIfInventory("CatacombClass",1,"PickupTimeFreezeSphereCatacomb")
        TNT1 A 0 A_Jump(256,"PickupTimeFreezeSphereDefault") // for inheriting actors
        goto PickupTimeFreezeSphereDefault

      PickupTimeFreezeSphereDefault:
        goto PickupTimeFreezeSphereSuccess

      PickupTimeFreezeSphereHeretic:
        TNT1 A 0 A_JumpIfInventory("SamsaraTimeFreezeInventoryHeretic",0,"PickupJump")
        goto PickupTimeFreezeSphereSuccess

      PickupTimeFreezeSphereCatacomb:
        TNT1 A 0 A_JumpIfInventory("Catacomb_Hourglass",1,1)
        goto PickupTimeFreezeSphereSuccess
        TNT1 A 0 A_JumpIfInventory("Catacomb_HourglassCooldown",1,"PickupTimeFreezeSphereSuccess")
        goto PickupJump

      PickupTimeFreezeSphereSuccess:
        TNT1 A 0 A_GiveInventory("SamsaraTimeFreeze")
        stop

      // Full Invisibility
      PickupInvisibilitySphere:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupInvisibilitySphereHeretic")
        TNT1 A 0 A_Jump(256,"PickupInvisibilitySphereDefault") // for inheriting actors
        goto PickupInvisibilitySphereDefault

      PickupInvisibilitySphereDefault:
        goto PickupInvisibilitySphereSuccess

      PickupInvisibilitySphereHeretic:
        TNT1 A 0 A_JumpIfInventory("SamsaraFullInvisibilityInventoryHeretic",0,"PickupJump")
        goto PickupInvisibilitySphereSuccess

      PickupInvisibilitySphereSuccess:
        TNT1 A 0 A_GiveInventory("SamsaraFullInvisibility")
        stop

      // Damage Booster
      PickupDoomsphere:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupDoomsphereHeretic")
        TNT1 A 0 A_Jump(256,"PickupDoomsphereDefault") // for inheriting actors
        goto PickupDoomsphereDefault

      PickupDoomsphereDefault:
        goto PickupDoomsphereSuccess

      PickupDoomsphereHeretic:
        TNT1 A 0 A_JumpIfInventory("SamsaraDamageBoosterInventoryHeretic",0,"PickupJump")
        goto PickupDoomsphereSuccess

      PickupDoomsphereSuccess:
        TNT1 A 0 A_GiveInventory("SamsaraDamageBooster")
        stop

      // Speed Booster
      PickupTurbosphere:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupTurbosphereHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupTurbosphereHexen1")
        TNT1 A 0 A_JumpIfInventory("DukeClass",1,"PickupTurbosphereDuke")
        TNT1 A 0 A_Jump(256,"PickupTurbosphereDefault") // for inheriting actors
        goto PickupTurbosphereDefault

      PickupTurbosphereDefault:
        goto PickupTurbosphereSuccess

      PickupTurbosphereHeretic:
        TNT1 A 0 A_JumpIfInventory("SamsaraSpeedBootsPickupInventoryRaven",0,"PickupJump")
        goto PickupTurbosphereSuccess

      PickupTurbosphereHexen1:
        goto PickupTurbosphereHeretic

      PickupTurbosphereDuke:
        TNT1 A 0 A_JumpIfInventory("DukePortSteroids",1,3)
        TNT1 A 0 A_JumpIfInventory("DukePortSteroidsLAB",1,2)
        TNT1 A 0 A_JumpIfInventory("DukePortSteroids64",1,1)
        goto PickupTurbosphereSuccess
        TNT1 A 0 A_JumpIfInventory("DukeSteroidsFuel",0,"PickupJump")
        goto PickupTurbosphereSuccess

      PickupTurbosphereSuccess:
        TNT1 A 0 A_GiveInventory("SamsaraSpeedBooster")
        stop
    }
}

actor SamsaraSkulltagRandomPowerup : SamsaraRandomPowerup replaces RandomPowerup
{
    +COUNTITEM
    +NOGRAVITY
}
