Actor Q2GrenadeLauncher : Q2Weapon
{
	Tag "Grenade Launcher"
	Inventory.PickupMessage "Grenade Launcher"
	Weapon.AmmoGive 5
	Weapon.AmmoType RocketAmmo
	Weapon.AmmoUse 1
	Weapon.SlotNumber 9
	Inventory.RestrictedTo "Bitterman"		
	States
	{
	Spawn:
		Q2WP A -1
		Stop
	Select:
		TNT1 A 0 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_TakeInventory(Q2WeaponIndex)
		TNT1 A 0 A_GiveInventory(Q2WeaponIndex,9)
		GRL0 ABCDEF 4
		Goto Ready+1
	Deselect:
		GRL1 A 2
		GRL0 STUVW 3
		Goto InstantDeselect
	InstantDeselect:
		TNT1 AAAAAAAAAAAAAAAAAAAAAAAAAAAA 0 A_Lower
		TNT1 A 1 A_Lower
		Wait
	Ready:
		TNT1 A 0 A_Jump(32,2)
		GRL1 A 1 A_WeaponReady
		Loop
		GRL1 "BCDEFGHIJKLMNOPQRSTUVWXYZ[^]" 5 A_WeaponReady
		GRL2 ABCDEFGHIJKLMN 5 A_WeaponReady
		Goto Ready+1
	Fire:
		TNT1 A 0 A_JumpIfInventory("CoopModeOn", 1, "CoopFire")
		TNT1 A 0 A_JumpIfInventory(PowerSilencer,1,"SilentFire")
		TNT1 A 0 A_AlertMonsters
		TNT1 A 0 A_PlaySound("Q2Weapons/GrenadeLauncherFire",CHAN_WEAPON)
		TNT1 A 0 A_FireCustomMissile(Q2Grenade,0,1,9,0,0,10)
		TNT1 A 0 A_GunFlash
		GRL0 HI 3
		TNT1 A 0 A_AlertMonsters
		TNT1 A 0 A_PlaySound("Q2Weapons/GrenadeLauncherReload",0)
		GRL0 JKLMNOPQR 4
		GRL1 A 2
		Goto Ready
	SilentFire:
		TNT1 A 0 A_PlaySound("Q2Weapons/GrenadeLauncherFire",CHAN_WEAPON,0.25,0,3)
		TNT1 A 0 A_JumpIfInventory("CoopModeOn", 1, "CoopFire")
		TNT1 A 0 A_FireCustomMissile(Q2Grenade,0,1,9,0,0,10)
		TNT1 A 0 A_GunFlash
		GRL0 HI 3
		TNT1 A 0 A_PlaySound("Q2Weapons/GrenadeLauncherReload",0,0.5,0,3)
		GRL0 JKLMNOPQR 4
		GRL1 A 2
		Goto Ready
	CoopFire:
		TNT1 A 0 A_JumpIfInventory(PowerSilencer,1,"SilentCoopFire")
		TNT1 A 0 A_AlertMonsters
		TNT1 A 0 A_PlaySound("Q2Weapons/GrenadeLauncherFire",CHAN_WEAPON)
		TNT1 A 0 A_FireCustomMissile(Q2Grenade_Coop,0,1,9,0,0,10)
		TNT1 A 0 A_GunFlash
		GRL0 HI 3
		TNT1 A 0 A_AlertMonsters
		TNT1 A 0 A_PlaySound("Q2Weapons/GrenadeLauncherReload",0)
		GRL0 JKLMNOPQR 4
		GRL1 A 2
		Goto Ready
	SilentCoopFire:
		TNT1 A 0 A_PlaySound("Q2Weapons/GrenadeLauncherFire",CHAN_WEAPON,0.25,0,3)
		TNT1 A 0 A_FireCustomMissile(Q2Grenade_Coop,0,1,9,0,0,10)
		TNT1 A 0 A_GunFlash
		GRL0 HI 3
		TNT1 A 0 A_PlaySound("Q2Weapons/GrenadeLauncherReload",0,0.5,0,3)
		GRL0 JKLMNOPQR 4
		GRL1 A 2
		Goto Ready
	DFire:
		GRL0 JKLM 4
		GRL0 NOPQR 4 A_WeaponReady
		Goto Ready
	Flash:
		TNT1 A 1 A_Light2
		TNT1 A 0 A_SetPitch(Pitch-5.0)
		TNT1 AAAAA 1 A_SetPitch(Pitch+0.5)
		TNT1 A 0 A_Light1
		TNT1 AAAAA 1 A_SetPitch(Pitch+0.5)
		Goto LightDone
	}
}
Actor Q2Grenade
{
	Projectile
	-NOGRAVITY +FORCERADIUSDMG +MOVEWITHSECTOR
	Speed 25
	Gravity 0.66
	Damage 20
	Radius 5
	Height 10
	BounceType Doom
	BounceSound "Q2Weapons/GrenadeBounce"
	DamageType "BittermanDamage"
	Var Int User_Angle;
	States
	{
	Spawn:
		TNT1 A 0 NoDelay A_Jump(128,2)
		TNT1 A 0 A_SetUserVar(User_Angle,Random(1,6))
		Goto Idle
		TNT1 A 0 A_SetUserVar(User_Angle,Random(-6,-1))
	Idle:
		TNT1 AAA 0 A_SpawnItemEx(Q2GrenadeSmoke,Random2(5),0,Random2(5),0,0,FRandom(0.1,0.5),Random(1,360),0,128)
		TNT1 A 0 A_SetAngle(Angle+User_Angle)
		SGRN A 1 A_SetPitch(Pitch-15)
		Loop
	Death:
		TNT1 A 0 A_PlaySound("Q2Weapons/GrenadeBounce")
		SGRN AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA 1 A_SpawnItemEx(Q2GrenadeSmoke,Random2(5),0,Random2(5),0,0,FRandom(0.1,1),Random(1,360),0,128)
		TNT1 A 0 A_Jump(256,"XDeath")
	XDeath:
		TNT1 A 0 A_PlaySound("Q2Weapons/GrenadeExplosion")
		TNT1 A 0 A_SpawnItem(Q2Explosion)
		TNT1 A 5 A_Explode
		Stop
	}
}
Actor Q2Grenade_Coop : Q2Grenade { Species "Player" +THRUSPECIES +DONTHARMCLASS +DONTHARMSPECIES }
Actor Q2GrenadeSmoke : Q2BulletPuffParticle
{
	Scale 1
	States
	{
	Fade:
		"----" A 1 A_FadeOut(0.025)
		Wait
	}
}
Actor Q2ETFRifle : Q2Weapon
{
	Tag "ETF Rifle"
	Inventory.PickupMessage "ETF Rifle"
	Weapon.AmmoGive 50
	Weapon.AmmoType Q2Flechettes
	Weapon.AmmoUse 1
	Weapon.SlotNumber 9
	Inventory.RestrictedTo "Bitterman"		
	States
	{
	Spawn:
		Q2WP A -1
		Stop
	Select:
		TNT1 A 0 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_TakeInventory(Q2WeaponIndex)
		TNT1 A 0 A_GiveInventory(Q2WeaponIndex,10)
		ETF0 ABCDE 4
		Goto Ready+1
	Deselect:
//		ETF0 U 2
		ETF1 IJKL 3
		Goto InstantDeselect
	InstantDeselect:
		TNT1 AAAAAAAAAAAAAAAAAAAAAAAAAAAA 0 A_Lower
		TNT1 A 1 A_Lower
		Wait
	Ready:
		TNT1 A 0 A_Jump(24,2)
		ETF0 H 1 A_WeaponReady
		Loop
		ETF0 "HIJKLMNOPQRSTUVWXYZ[\]" 5 A_WeaponReady
		ETF1 ABCDEFGH 5 A_WeaponReady
		Goto Ready+1
	Fire:
		ETF0 F 0 A_JumpIfInventory("CoopModeOn", 1, "CoopFire")
		ETF0 F 0 A_JumpIfInventory(PowerSilencer,1,"SilentFire")
		ETF0 F 0 A_AlertMonsters
		ETF0 F 0 A_PlaySound("Q2Weapons/ETFFire",CHAN_WEAPON)
		ETF0 F 0 A_FireCustomMissile(Q2ETFFlechette,0,1,8,4)
		TNT1 A 0 A_FireCustomMissile(Q2WeaponFlash,0,0)
		ETF0 F 0 A_GunFlash
		ETF0 F 0 A_JumpIf(CallACS("Q2ETFRifleShake",1), 1)
		ETF0 F 1
		ETF0 G 2
		ETF0 G 0 A_JumpIfNoAmmo("Ready")
		ETF0 G 0 A_AlertMonsters
		ETF0 G 0 A_PlaySound("Q2Weapons/ETFFire",CHAN_WEAPON)
		ETF0 G 0 A_FireCustomMissile(Q2ETFFlechette,0,1,4,4)
		TNT1 A 0 A_FireCustomMissile(Q2WeaponFlash,0,0)
		ETF0 G 0 A_GunFlash
		ETF0 G 0 A_JumpIf(CallACS("Q2ETFRifleShake",2), 1)
		ETF0 G 1
		ETF0 F 2
		Goto Ready
	SilentFire:
		ETF0 F 0 A_PlaySound("Q2Weapons/ETFFire",CHAN_WEAPON,0.25,0,3)
		ETF0 F 0 A_FireCustomMissile(Q2ETFFlechette,0,1,8,4)
		TNT1 A 0 A_FireCustomMissile(Q2WeaponFlash,0,0)
		ETF0 F 0 A_GunFlash
		ETF0 F 0 A_JumpIf(CallACS("Q2ETFRifleShake",1), 1)
		ETF0 F 1
		ETF0 G 2
		ETF0 G 0 A_JumpIfNoAmmo("Ready")
		ETF0 G 0 A_PlaySound("Q2Weapons/ETFFire",CHAN_WEAPON,0.25,0,3)
		ETF0 G 0 A_FireCustomMissile(Q2ETFFlechette,0,1,4,4)
		TNT1 A 0 A_FireCustomMissile(Q2WeaponFlash,0,0)
		ETF0 G 0 A_GunFlash
		ETF0 G 0 A_JumpIf(CallACS("Q2ETFRifleShake",2), 1)
		ETF0 G 1
		ETF0 F 2
		Goto Ready
	CoopFire:
		ETF0 F 0 A_JumpIfInventory(PowerSilencer,1,"SilentCoopFire")
		ETF0 F 0 A_AlertMonsters
		ETF0 F 0 A_PlaySound("Q2Weapons/ETFFire",CHAN_WEAPON)
		ETF0 F 0 A_Jump(256,2)
		ETF0 F 0 A_PlaySound("Q2Weapons/ETFFire",CHAN_WEAPON,0.25,0,3)
		ETF0 F 0 A_FireCustomMissile(Q2ETFFlechette_Coop,0,1,8,4)
		TNT1 A 0 A_FireCustomMissile(Q2WeaponFlash,0,0)
		ETF0 F 0 A_GunFlash
		ETF0 F 0 A_JumpIf(CallACS("Q2ETFRifleShake",1), 1)
		ETF0 F 1
		ETF0 G 2
		ETF0 G 0 A_JumpIfInventory(PowerSilencer,1,4)
		ETF0 G 0 A_JumpIfNoAmmo("Ready")
		ETF0 G 0 A_AlertMonsters
		ETF0 G 0 A_PlaySound("Q2Weapons/ETFFire",CHAN_WEAPON)
		ETF0 G 0 A_Jump(256,2)
		ETF0 G 0 A_PlaySound("Q2Weapons/ETFFire",CHAN_WEAPON,0.25,0,3)
		ETF0 G 0 A_FireCustomMissile(Q2ETFFlechette_Coop,0,1,4,4)
		TNT1 A 0 A_FireCustomMissile(Q2WeaponFlash,0,0)
		ETF0 G 0 A_GunFlash
		ETF0 G 0 A_JumpIf(CallACS("Q2ETFRifleShake",2), 1)
		ETF0 G 1
		ETF0 F 2
		Goto Ready
	SilentCoopFire:
		ETF0 F 0 A_PlaySound("Q2Weapons/ETFFire",CHAN_WEAPON,0.25,0,3)
		ETF0 F 0 A_FireCustomMissile(Q2ETFFlechette_Coop,0,1,8,4)
		TNT1 A 0 A_FireCustomMissile(Q2WeaponFlash,0,0)
		ETF0 F 0 A_GunFlash
		ETF0 F 0 A_JumpIf(CallACS("Q2ETFRifleShake",1), 1)
		ETF0 F 1
		ETF0 G 2
		ETF0 G 0 A_JumpIfNoAmmo("Ready")
		ETF0 G 0 A_PlaySound("Q2Weapons/ETFFire",CHAN_WEAPON,0.25,0,3)
		ETF0 G 0 A_FireCustomMissile(Q2ETFFlechette_Coop,0,1,4,4)
		TNT1 A 0 A_FireCustomMissile(Q2WeaponFlash,0,0)
		ETF0 G 0 A_GunFlash
		ETF0 G 0 A_JumpIf(CallACS("Q2ETFRifleShake",2), 1)
		ETF0 G 1
		ETF0 F 2
		Goto Ready
	Flash:
		TNT1 A 1 A_Light2
		Goto LightDone
	}
}
Actor Q2ETFFlechette : FastProjectile
{
	Radius 3
	Height 6
	Speed 32
	Damage (14)
	MissileHeight 8
	DeathSound "Q2Weapons/LaserHit"
	+BLOODSPLATTER
	+HITTRACER
	Decal BlasterScorch
	Scale 0.5
	States
	{
	Spawn:
		NULL A 1 Bright  A_PlaySound("Q2Weapons/LaserFly",CHAN_VOICE,0.5,1)
		Loop
	Death:
		TNT1 A 0 A_SpawnItem(FlechetteProjectileImpact)
		TNT1 A 3
		TNT1 A 3 
		TNT1 A 3 
		TNT1 A 3 
		Stop
	XDeath:
		TNT1 A 0 A_JumpIf(CallACS("Q2FlechetteShieldPierce"),"DeathPierceShield")
		TNT1 A 5
		Stop
	DeathPierceShield:
		TNT1 A 0 A_CustomMissile("Q2ETFFlechettePierce",0,0,0,CMF_AIMDIRECTION,pitch)
		TNT1 A 5
		stop
	}
}
Actor Q2ETFFlechettePierce : Q2ETFFlechette
{
	+THRUSPECIES
	States
	{
		Spawn:
			TNT1 A 0
			TNT1 A 0 A_JumpIf(CallACS("Q2FlechetteRetrieveSpecies"),1)
			TNT1 A 0 A_TransferPointer(AAPTR_Target,AAPTR_Default,AAPTR_Target,AAPTR_Target)
			NULL A 1 Bright  A_PlaySound("Q2Weapons/LaserFly",CHAN_VOICE,0.5,1)
			Loop
	}
}
Actor Q2ETFFlechette_Coop : Q2ETFFlechette	{ Species "Player" +THRUSPECIES }
Actor FlechetteProjectileImpact : Q2BulletPuff
{
	DamageType "BittermanDamage"
	States
	{
	Spawn:
		TNT1 AAAAAAAAAAAAA 0 A_SpawnItemEx(FlechetteParticle,FRandom(0,12),0,FRandom(-8,15),FRandom(0,0.5),0,FRandom(-1,-0.1),Random(1,360))
		Stop
	}
}
Actor FlechetteParticle : Q2BulletPuffParticle { Translation "80:111=192:196" }
Actor Q2IonRipper : Q2Weapon
{
	Tag "Ion Ripper"
	Inventory.PickupMessage "Ion Ripper"
	Weapon.UpSound "Q2Weapons/IonActive"
	Weapon.AmmoGive 50
	Weapon.AmmoType Cell
	Weapon.AmmoUse 2
	Weapon.SlotNumber 9
	Inventory.RestrictedTo "Bitterman"	
	States
	{
	Spawn:
		Q2WP A -1
		Stop
	Select:
		TNT1 A 0 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_TakeInventory(Q2WeaponIndex)
		TNT1 A 0 A_GiveInventory(Q2WeaponIndex,11)
		TNT1 A 0 A_PlaySound("Q2Weapons/IonIdle",CHAN_5,0.5,1)
		ION0 ABCDE 4
		Goto Ready+1
	Deselect:
		TNT1 A 0 A_StopSound(CHAN_5)
		TNT1 A 0 A_PlaySound("Q2Weapons/IonAway",CHAN_5)
		ION0 U 2
		ION1 IJKL 3
		Goto InstantDeselect
	InstantDeselect:
		TNT1 AAAAAAAAAAAAAAAAAAAAAAAAAAAA 0 A_Lower
		TNT1 A 1 A_Lower
		Wait
	Ready:
		TNT1 A 0 A_Jump(24,2)
		ION0 H 1 A_WeaponReady
		Loop
		ION0 "HIJKLMNOPQRSTUVWXYZ[\]" 5 A_WeaponReady
		ION1 ABCDEFGH 5 A_WeaponReady
		Goto Ready+1
	Fire:
		TNT1 A 0 A_JumpIfInventory("CoopModeOn", 1, "CoopFire")
		TNT1 A 0 A_JumpIfInventory(PowerSilencer,1,"SilentFire")
		TNT1 A 0 A_AlertMonsters
		TNT1 A 0 A_PlaySound("Q2Weapons/IonFire",CHAN_WEAPON)
		TNT1 A 0 A_FireCustomMissile(Q2WeaponFlash,0,0)
		TNT1 A 0 A_FireCustomMissile(Q2IonBoomerang,0,1,8,4)
		ION0 FGF 6
		Goto Ready
	SilentFire:
		TNT1 A 0 A_PlaySound("Q2Weapons/IonFire",CHAN_WEAPON,0.25,0,3)
		TNT1 A 0 A_FireCustomMissile(Q2WeaponFlash,0,0)
		TNT1 A 0 A_FireCustomMissile(Q2IonBoomerang,0,1,8,4)
		ION0 FGF 6
		Goto Ready
	CoopFire:
		TNT1 A 0 A_JumpIfInventory(PowerSilencer,1,"SilentCoopFire")
		TNT1 A 0 A_AlertMonsters
		TNT1 A 0 A_PlaySound("Q2Weapons/IonFire",CHAN_WEAPON)
		TNT1 A 0 A_FireCustomMissile(Q2WeaponFlash,0,0)
		TNT1 A 0 A_FireCustomMissile(Q2IonBoomerang_Coop,0,1,8,4)
		ION0 FGF 6
		Goto Ready
	SilentCoopFire:
		TNT1 A 0 A_PlaySound("Q2Weapons/IonFire",CHAN_WEAPON,0.25,0,3)
		TNT1 A 0 A_FireCustomMissile(Q2WeaponFlash,0,0)
		TNT1 A 0 A_FireCustomMissile(Q2IonBoomerang_Coop,0,1,8,4)
		ION0 FGF 6
		Goto Ready
	Flash:
		TNT1 A 1 A_Light1
		TNT1 A 0 A_SetPitch(Pitch-0.005)
		TNT1 A 1
		TNT1 A 0 A_SetPitch(Pitch+0.005)
		Goto LightDone
	}
}
Actor Q2IonBoomerang 
{
	Radius 4
	Height 2
	Speed 16
	Damage (50)
	DeathSound "Q2Weapons/IonExplode"
	BounceSound "Q2Weapons/IonHit"
	+BLOODSPLATTER
	+NOGRAVITY
	Projectile
	Decal BlasterScorch
	DamageType "BittermanDamage"
	BounceType "Hexen"
	BounceCount 5
	var int user_trailcount;
	States
	{
	Spawn:
		TNT1 A 0
		TNT1 A 0 A_SetUserVar("user_trailcount", 0)
		TNT1 A 0 A_JumpIf(user_trailcount == 8,3)
		TNT1 A 0 A_SetUserVar("user_trailcount", user_trailcount+1)
		TNT1 A 0 A_SpawnItem("BlasterTrailSpawner",-user_trailcount,2)
		Goto Spawn+2
		NULL A 1 Bright A_PlaySound("Q2Weapons/LaserFly",CHAN_VOICE,0.5,1)
		Loop
	Death:
		TNT1 A 1
		Stop
	Crash:
	XDeath:
		TNT1 A 5
		Stop
	}
}

Actor Q2IonBoomerang_Coop : Q2IonBoomerang { Species "Player" +THRUSPECIES }